<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>qsprpred.data.data &mdash; QSPRpred 2.0.1 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
 

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LJT8KBYKKV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LJT8KBYKKV');
</script>


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            QSPRpred
          </a>
              <div class="version">
                v2.0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome to QSPRpredâ€™s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../use.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../use.html#cli-example">CLI Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/modules.html">Python API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">QSPRpred</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">qsprpred.data.data</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for qsprpred.data.data</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;This module contains the QSPRDataset that holds and prepares data for modelling.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">concurrent</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Callable</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Optional</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="kn">import</span> <span class="n">PandasTools</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">KFold</span><span class="p">,</span> <span class="n">StratifiedKFold</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span>
<span class="kn">from</span> <span class="nn">tqdm.auto</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">from</span> <span class="nn">..logs</span> <span class="kn">import</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">..models.tasks</span> <span class="kn">import</span> <span class="n">TargetTasks</span>
<span class="kn">from</span> <span class="nn">..utils.inspect</span> <span class="kn">import</span> <span class="n">import_class</span>
<span class="kn">from</span> <span class="nn">.interfaces</span> <span class="kn">import</span> <span class="n">DataSet</span><span class="p">,</span> <span class="n">DataSplit</span><span class="p">,</span> <span class="n">MoleculeDataSet</span>
<span class="kn">from</span> <span class="nn">.utils.feature_standardization</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">SKLearnStandardizer</span><span class="p">,</span>
    <span class="n">apply_feature_standardizer</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.utils.folds</span> <span class="kn">import</span> <span class="n">Folds</span>
<span class="kn">from</span> <span class="nn">.utils.scaffolds</span> <span class="kn">import</span> <span class="n">Scaffold</span>
<span class="kn">from</span> <span class="nn">.utils.smiles_standardization</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">check_smiles_valid</span><span class="p">,</span>
    <span class="n">chembl_smi_standardizer</span><span class="p">,</span>
    <span class="n">old_standardize_sanitize</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="PandasDataSet"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.PandasDataSet">[docs]</a><span class="k">class</span> <span class="nc">PandasDataSet</span><span class="p">(</span><span class="n">DataSet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A Pandas DataFrame wrapper class to enable data processing functions on</span>
<span class="sd">    QSPRpred data.</span>

<span class="sd">    Arguments</span>
<span class="sd">        name (str): Name of the data set. You can use this name to load the dataset</span>
<span class="sd">            from disk anytime and create a new instance.</span>
<span class="sd">        df (pd.DataFrame): Pandas dataframe containing the data. If you provide a</span>
<span class="sd">            dataframe for a dataset that already exists on disk, the dataframe from</span>
<span class="sd">            disk will override the supplied data frame. Set &#39;overwrite&#39; to `True` to</span>
<span class="sd">            override the data frame on disk.</span>
<span class="sd">        store_dir (int): Directory to store the dataset files. Defaults to the</span>
<span class="sd">            current directory. If it already contains files with the same name,</span>
<span class="sd">            the existing data will be loaded.</span>
<span class="sd">        overwrite (bool): Overwrite existing dataset.</span>
<span class="sd">        index_cols (List): List of columns to use as index. If None, the index</span>
<span class="sd">            will be a custom generated ID.</span>
<span class="sd">        n_jobs (int): Number of jobs to use for parallel processing. If &lt;= 0,</span>
<span class="sd">            all available cores will be used.</span>
<span class="sd">        chunk_size (int): Size of chunks to use per job in parallel processing.</span>
<span class="sd">        id_prefix (str): Prefix to use for custom generated IDs.&quot;&quot;&quot;</span>
<div class="viewcode-block" id="PandasDataSet.ParallelApplyWrapper"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.PandasDataSet.ParallelApplyWrapper">[docs]</a>    <span class="k">class</span> <span class="nc">ParallelApplyWrapper</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A wrapper class to parallelize pandas apply functions.&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
            <span class="n">func_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">func_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">result_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;expand&quot;</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Initialize the instance with pandas parameters to apply to data chunks.</span>

<span class="sd">            See `pandas.DataFrame.apply` for more information.</span>

<span class="sd">            Args:</span>
<span class="sd">                func (Callable): Function to apply to the data frame.</span>
<span class="sd">                func_args (list): Positional arguments to pass to the function.</span>
<span class="sd">                func_kwargs (dict): Keyword arguments to pass to the function.</span>
<span class="sd">                axis (int): Axis to apply func along (0 for columns, 1 for rows).</span>
<span class="sd">                raw (bool): Whether to pass Series object to func or raw array.</span>
<span class="sd">                result_type (str): whether to expand/ignore the results.</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">func_args</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">func_kwargs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raw</span> <span class="o">=</span> <span class="n">raw</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_type</span> <span class="o">=</span> <span class="n">result_type</span>

        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Apply the function to the current chunk of data.</span>

<span class="sd">            Args:</span>
<span class="sd">                data (pd.DataFrame): chunk of data to apply function to</span>

<span class="sd">            Returns:</span>
<span class="sd">                result of applying function to chunk of data</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span>
                <span class="n">raw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">raw</span><span class="p">,</span>
                <span class="n">axis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span>
                <span class="n">result_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">result_type</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
                <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="k">else</span> <span class="p">{},</span>
            <span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">store_dir</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">index_cols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">id_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;QSPRID&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Initialize a `PandasDataSet` object.</span>
<span class="sd">        Args</span>
<span class="sd">            name (str): Name of the data set. You can use this name to load the dataset</span>
<span class="sd">                from disk anytime and create a new instance.</span>
<span class="sd">            df (pd.DataFrame): Pandas dataframe containing the data. If you provide a</span>
<span class="sd">                dataframe for a dataset that already exists on disk, the dataframe from</span>
<span class="sd">                disk will override the supplied data frame. Set &#39;overwrite&#39; to `True` to</span>
<span class="sd">                override the data frame on disk.</span>
<span class="sd">            store_dir (int): Directory to store the dataset files. Defaults to the</span>
<span class="sd">                current directory. If it already contains files with the same name,</span>
<span class="sd">                the existing data will be loaded.</span>
<span class="sd">            overwrite (bool): Overwrite existing dataset.</span>
<span class="sd">            index_cols (List): List of columns to use as index. If None, the index</span>
<span class="sd">                will be a custom generated ID.</span>
<span class="sd">            n_jobs (int): Number of jobs to use for parallel processing. If &lt;= 0,</span>
<span class="sd">                all available cores will be used.</span>
<span class="sd">            chunk_size (int): Size of chunks to use per job in parallel processing.</span>
<span class="sd">            id_prefix (str): Prefix to use for custom generated IDs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexCols</span> <span class="o">=</span> <span class="n">index_cols</span>
        <span class="c1"># parallel settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nJobs</span> <span class="o">=</span> <span class="n">n_jobs</span> <span class="k">if</span> <span class="n">n_jobs</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chunkSize</span> <span class="o">=</span> <span class="n">chunk_size</span>
        <span class="c1"># paths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storeDir</span> <span class="o">=</span> <span class="n">store_dir</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storePrefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storeDir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storeDir</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Directory &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storeDir</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storePath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storePrefix</span><span class="si">}</span><span class="s2">_df.pkl&quot;</span>
        <span class="c1"># data frame initialization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isInStore</span><span class="p">(</span><span class="s2">&quot;df&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Existing data set found, but also found a data frame in store. &quot;</span>
                    <span class="s2">&quot;Refusing to overwrite data. If you want to overwrite data in &quot;</span>
                    <span class="s2">&quot;store, set overwrite=True.&quot;</span><span class="p">,</span>
                    <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reload</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clearFiles</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span>
                <span class="k">if</span> <span class="n">index_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setIndex</span><span class="p">(</span><span class="n">index_cols</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">id_prefix</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">))]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setIndex</span><span class="p">([</span><span class="n">id_prefix</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isInStore</span><span class="p">(</span><span class="s2">&quot;df&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No data frame found in store for &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;. Are you sure &quot;</span>
                    <span class="s2">&quot;this is the correct dataset? If you are creating a new data set, &quot;</span>
                    <span class="s2">&quot;make sure to supply a data frame.&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reload</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Unknown error in data set creation.&quot;</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the number of rows in the data frame.</span>

<span class="sd">        Returns: number of rows in the data frame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span>

<div class="viewcode-block" id="PandasDataSet.setIndex"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.PandasDataSet.setIndex">[docs]</a>    <span class="k">def</span> <span class="nf">setIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the index of the data frame.</span>

<span class="sd">        Args:</span>
<span class="sd">            cols (list[str]): list of columns to use as index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verify_integrity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
            <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Unnamed&quot;</span><span class="p">)],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;~&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexCols</span> <span class="o">=</span> <span class="n">cols</span></div>

    <span class="k">def</span> <span class="nf">_isInStore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a pickled file with the given suffix exists.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Suffix of the file to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: `True` if the file exists, `False` otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storePath</span>
                             <span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">storePath</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="PandasDataSet.getProperty"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.PandasDataSet.getProperty">[docs]</a>    <span class="k">def</span> <span class="nf">getProperty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a property of the data set.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the property to get.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.Series: List of values for the property.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></div>

<div class="viewcode-block" id="PandasDataSet.getProperties"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.PandasDataSet.getProperties">[docs]</a>    <span class="k">def</span> <span class="nf">getProperties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the properties of the data set.</span>

<span class="sd">        Returns: list of properties of the data set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span></div>

<div class="viewcode-block" id="PandasDataSet.addProperty"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.PandasDataSet.addProperty">[docs]</a>    <span class="k">def</span> <span class="nf">addProperty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a property to the data set.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the property.</span>
<span class="sd">            data (List): List of values for the property.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span></div>

<div class="viewcode-block" id="PandasDataSet.removeProperty"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.PandasDataSet.removeProperty">[docs]</a>    <span class="k">def</span> <span class="nf">removeProperty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a property from the data set.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the property to remove.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="PandasDataSet.getSubset"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.PandasDataSet.getSubset">[docs]</a>    <span class="k">def</span> <span class="nf">getSubset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a subset of the data set by providing a prefix for the column names or a</span>
<span class="sd">        column name directly.</span>

<span class="sd">        Args:</span>
<span class="sd">            prefix (str): Prefix of the column names to select.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">)]]</span></div>

<div class="viewcode-block" id="PandasDataSet.apply"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.PandasDataSet.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
        <span class="n">func_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">func_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">result_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;expand&quot;</span><span class="p">,</span>
        <span class="n">subset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply a function to the data frame.</span>

<span class="sd">        In addition to the arguments of `pandas.DataFrame.apply`, this method also</span>
<span class="sd">        supports parallelization using `multiprocessing.Pool`.</span>

<span class="sd">        Args:</span>
<span class="sd">            func (Callable): Function to apply to the data frame.</span>
<span class="sd">            func_args (list): Positional arguments to pass to the function.</span>
<span class="sd">            func_kwargs (dict): Keyword arguments to pass to the function.</span>
<span class="sd">            axis (int): Axis along which the function is applied</span>
<span class="sd">                (0 for column, 1 for rows).</span>
<span class="sd">            raw (bool): Whether to pass the data frame as-is to the function or to pass</span>
<span class="sd">                each row/column as a Series to the function.</span>
<span class="sd">            result_type (str): Whether to expand the result of the function to columns</span>
<span class="sd">                or to leave it as a Series.</span>
<span class="sd">            subset (list): list of column names if only a subset of the data should be</span>
<span class="sd">                used (reduces memory consumption).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_cpus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nJobs</span>
        <span class="n">chunk_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunkSize</span>
        <span class="k">if</span> <span class="n">n_cpus</span> <span class="ow">and</span> <span class="n">n_cpus</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s2">&quot;noParallelization&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">func</span><span class="o">.</span><span class="n">noParallelization</span> <span class="ow">is</span> <span class="kc">True</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">papply</span><span class="p">(</span>
                <span class="n">func</span><span class="p">,</span> <span class="n">func_args</span><span class="p">,</span> <span class="n">func_kwargs</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">raw</span><span class="p">,</span> <span class="n">result_type</span><span class="p">,</span> <span class="n">subset</span><span class="p">,</span> <span class="n">n_cpus</span><span class="p">,</span>
                <span class="n">chunk_size</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">subset</span> <span class="k">if</span> <span class="n">subset</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">df_sub</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="n">func</span><span class="p">,</span>
                <span class="n">raw</span><span class="o">=</span><span class="n">raw</span><span class="p">,</span>
                <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span>
                <span class="n">result_type</span><span class="o">=</span><span class="n">result_type</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="n">func_args</span><span class="p">,</span>
                <span class="o">**</span><span class="n">func_kwargs</span> <span class="k">if</span> <span class="n">func_kwargs</span> <span class="k">else</span> <span class="p">{},</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="PandasDataSet.papply"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.PandasDataSet.papply">[docs]</a>    <span class="k">def</span> <span class="nf">papply</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
        <span class="n">func_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">func_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">result_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;expand&quot;</span><span class="p">,</span>
        <span class="n">subset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">n_cpus</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parallelized version of `MoleculeTable.apply`.</span>

<span class="sd">        Args:</span>
<span class="sd">            func (Callable): Function to apply to the data frame.</span>
<span class="sd">            func_args (list): Positional arguments to pass to the function.</span>
<span class="sd">            func_kwargs (dict): Keyword arguments to pass to the function.</span>
<span class="sd">            axis (int): Axis along which the function is applied</span>
<span class="sd">                (0 for column, 1 for rows).</span>
<span class="sd">            raw (bool): Whether to pass the data frame as-is to the function or to pass</span>
<span class="sd">                each row/column as a Series to the function.</span>
<span class="sd">            result_type (str): Whether to expand the result of the function to columns</span>
<span class="sd">                or to leave it as a Series.</span>
<span class="sd">            subset (list): list of column names if only a subset of the data should be</span>
<span class="sd">                used (reduces memory consumption).</span>
<span class="sd">            n_cpus (int): Number of CPUs to use for parallelization.</span>
<span class="sd">            chunk_size (int): Number of rows to process in each chunk.</span>

<span class="sd">        Returns:</span>
<span class="sd">            result of applying function to data in chunks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_cpus</span> <span class="o">=</span> <span class="n">n_cpus</span> <span class="k">if</span> <span class="n">n_cpus</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
        <span class="n">df_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">subset</span> <span class="k">if</span> <span class="n">subset</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">df_sub</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">chunk_size</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_sub</span><span class="p">),</span> <span class="n">chunk_size</span><span class="p">)]</span>
        <span class="c1"># size of batches use in the process - more is faster, but uses more memory</span>
        <span class="n">batch_size</span> <span class="o">=</span> <span class="n">n_cpus</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">n_cpus</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">batches</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
                <span class="n">batches</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Parallel apply in progress for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">):</span>
                <span class="n">wrapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ParallelApplyWrapper</span><span class="p">(</span>
                    <span class="n">func</span><span class="p">,</span>
                    <span class="n">func_args</span><span class="o">=</span><span class="n">func_args</span><span class="p">,</span>
                    <span class="n">func_kwargs</span><span class="o">=</span><span class="n">func_kwargs</span><span class="p">,</span>
                    <span class="n">result_type</span><span class="o">=</span><span class="n">result_type</span><span class="p">,</span>
                    <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span>
                    <span class="n">raw</span><span class="o">=</span><span class="n">raw</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">executor</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">wrapped</span><span class="p">,</span> <span class="n">batch</span><span class="p">):</span>
                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="PandasDataSet.transform"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.PandasDataSet.transform">[docs]</a>    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">transformer</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">addAs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transform the data frame (or its part) using a list of transformers.</span>

<span class="sd">        Each transformer is a function that takes the data frame (or a subset of it as</span>
<span class="sd">        defined by the `targets` argument) and returns a transformed data frame. The</span>
<span class="sd">        transformed data frame can then be added to the original data frame if `addAs`</span>
<span class="sd">        is set to a `list` of new column names. If `addAs` is not `None`, the result of</span>
<span class="sd">        the application of transformers must have the same number of rows as the</span>
<span class="sd">        original data frame.</span>

<span class="sd">        Args:</span>
<span class="sd">            targets (list): list of column names to transform.</span>
<span class="sd">            transformer (Callable): Function that transforms the data in target columns</span>
<span class="sd">                to a new representation.</span>
<span class="sd">            addAs (list): If `True`, the transformed data is added to the original data</span>
<span class="sd">                frame and the</span>
<span class="sd">            names in this list are used as column names for the new data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">targets</span><span class="p">]</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">transformer</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">addAs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">addAs</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="PandasDataSet.filter"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.PandasDataSet.filter">[docs]</a>    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_filters</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Callable</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter the data frame using a list of filters.</span>

<span class="sd">        Each filter is a function that takes the data frame and returns a</span>
<span class="sd">        a new data frame with the filtered rows. The new data frame is then used as the</span>
<span class="sd">        input for the next filter. The final data frame is saved as the new data frame</span>
<span class="sd">        of the `MoleculeTable`.&quot;&quot;&quot;</span>
        <span class="n">df_filtered</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">table_filter</span> <span class="ow">in</span> <span class="n">table_filters</span><span class="p">:</span>
            <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">table_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df_filtered</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

<div class="viewcode-block" id="PandasDataSet.save"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.PandasDataSet.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the data frame to disk and all associated files.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Path to the saved data frame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># save data frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storePath</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">storePath</span></div>

<div class="viewcode-block" id="PandasDataSet.clearFiles"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.PandasDataSet.clearFiles">[docs]</a>    <span class="k">def</span> <span class="nf">clearFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove all files associated with this data set from disk.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storeDir</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;.json&quot;</span><span class="p">))</span>
        <span class="p">]:</span>
            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storeDir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PandasDataSet.reload"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.PandasDataSet.reload">[docs]</a>    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reload the data table from disk.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storePath</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexCols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexCols</span><span class="p">)</span></div>

<div class="viewcode-block" id="PandasDataSet.fromFile"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.PandasDataSet.fromFile">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fromFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;PandasDataSet&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a `MoleculeTable` instance from by providing a direct path to the</span>
<span class="sd">        pickled data frame in storage.&quot;&quot;&quot;</span>
        <span class="n">store_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">PandasDataSet</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">store_dir</span><span class="o">=</span><span class="n">store_dir</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>  <span class="c1"># noqa: B026 # FIXME: this is a bug in flake8...</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="PandasDataSet.getDF"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.PandasDataSet.getDF">[docs]</a>    <span class="k">def</span> <span class="nf">getDF</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the data frame this instance manages.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: The data frame this instance manages.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span></div>

<div class="viewcode-block" id="PandasDataSet.shuffle"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.PandasDataSet.shuffle">[docs]</a>    <span class="k">def</span> <span class="nf">shuffle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Shuffle the internal data frame.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="DescriptorTable"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.DescriptorTable">[docs]</a><span class="k">class</span> <span class="nc">DescriptorTable</span><span class="p">(</span><span class="n">PandasDataSet</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">calculator</span><span class="p">,</span>
        <span class="n">name_prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">store_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">key_cols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a `DescriptorTable` object.</span>
<span class="sd">        #TODO: Fill in docstring</span>
<span class="sd">        Args:</span>
<span class="sd">            calculator ():</span>
<span class="sd">            name_prefix (str):</span>
<span class="sd">            df (pd.DataFrame):</span>
<span class="sd">            store_dir (str):</span>
<span class="sd">            overwrite (bool):</span>
<span class="sd">            key_cols (list):</span>
<span class="sd">            n_jobs (int):</span>
<span class="sd">            chunk_size (int):</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">calculator</span><span class="o">.</span><span class="n">getPrefix</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">store_dir</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">,</span>
            <span class="n">key_cols</span><span class="p">,</span> <span class="n">n_jobs</span><span class="p">,</span> <span class="n">chunk_size</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculator</span> <span class="o">=</span> <span class="n">calculator</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the prefix of the descriptors in this table.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculator</span><span class="o">.</span><span class="n">getPrefix</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">keyCols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the key columns of this table.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexCols</span>

<div class="viewcode-block" id="DescriptorTable.getDescriptors"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.DescriptorTable.getDescriptors">[docs]</a>    <span class="k">def</span> <span class="nf">getDescriptors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the descriptors in this table.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getDescriptorNames</span><span class="p">()]</span></div>

<div class="viewcode-block" id="DescriptorTable.getDescriptorNames"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.DescriptorTable.getDescriptorNames">[docs]</a>    <span class="k">def</span> <span class="nf">getDescriptorNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the names of the descriptors in this table.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_&quot;</span><span class="p">)]</span></div>

<div class="viewcode-block" id="DescriptorTable.fillMissing"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.DescriptorTable.fillMissing">[docs]</a>    <span class="k">def</span> <span class="nf">fillMissing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fill_value</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fill missing values in the descriptor table.</span>

<span class="sd">        Args:</span>
<span class="sd">            fill_value (float): Value to fill missing values with.</span>
<span class="sd">            names (list): List of descriptor names to fill. If `None`, all descriptors</span>
<span class="sd">                are filled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">names</span> <span class="k">if</span> <span class="n">names</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDescriptorNames</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">fill_value</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="MoleculeTable"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable">[docs]</a><span class="k">class</span> <span class="nc">MoleculeTable</span><span class="p">(</span><span class="n">PandasDataSet</span><span class="p">,</span> <span class="n">MoleculeDataSet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class that holds and prepares molecule data for modelling and other analyses.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">smiles_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;SMILES&quot;</span><span class="p">,</span>
        <span class="n">add_rdkit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">store_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">drop_invalids</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">index_cols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a `MoleculeTable` object.</span>

<span class="sd">        This object wraps a pandas dataframe and provides short-hand methods to prepare</span>
<span class="sd">        molecule data for modelling and analysis.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the dataset. You can use this name to load the dataset</span>
<span class="sd">                from disk anytime and create a new instance.</span>
<span class="sd">            df (pd.DataFrame): Pandas dataframe containing the data. If you provide a</span>
<span class="sd">                dataframe for a dataset that already exists on disk,</span>
<span class="sd">            the dataframe from disk will override the supplied data frame. Set</span>
<span class="sd">                &#39;overwrite&#39; to `True` to override the data frame on disk.</span>
<span class="sd">            smiles_col (str): Name of the column containing the SMILES sequences</span>
<span class="sd">                of molecules.</span>
<span class="sd">            add_rdkit (bool): Add RDKit molecule instances to the dataframe.</span>
<span class="sd">                WARNING: This can take a lot of memory.</span>
<span class="sd">            store_dir (str): Directory to store the dataset files. Defaults to the</span>
<span class="sd">                current directory. If it already contains files with the same name,</span>
<span class="sd">                the existing data will be loaded.</span>
<span class="sd">            overwrite (bool): Overwrite existing dataset.</span>
<span class="sd">            n_jobs (int): Number of jobs to use for parallel processing. If &lt;= 0, all</span>
<span class="sd">                available cores will be used.</span>
<span class="sd">            chunk_size (int): Size of chunks to use per job in parallel processing.</span>
<span class="sd">            drop_invalids (bool): Drop invalid molecules from the data frame.</span>
<span class="sd">            index_cols (list[str]): list of columns to use as index. If None, the index</span>
<span class="sd">                will be a custom generated ID.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptorCalculators</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># holds all descriptor calculators</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># holds descriptor tables for each calculator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptorCalculatorsPathPrefix</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">store_dir</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">,</span> <span class="n">index_cols</span><span class="p">,</span> <span class="n">n_jobs</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptorCalculatorsPathPrefix</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">descriptorCalculatorsPathPrefix</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storePrefix</span><span class="si">}</span><span class="s2">_descriptor_calculator&quot;</span>
            <span class="p">)</span>
        <span class="c1"># settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smilesCol</span> <span class="o">=</span> <span class="n">smiles_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">includesRdkit</span> <span class="o">=</span> <span class="n">add_rdkit</span>
        <span class="c1"># add rdkit molecules if requested</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">includesRdkit</span> <span class="ow">and</span> <span class="s2">&quot;RDMol&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">PandasTools</span><span class="o">.</span><span class="n">AddMoleculeColumnToFrame</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span>
                <span class="n">smilesCol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smilesCol</span><span class="p">,</span>
                <span class="n">molCol</span><span class="o">=</span><span class="s2">&quot;RDMol&quot;</span><span class="p">,</span>
                <span class="n">includeFingerprints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">includesRdkit</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># drop invalid columns</span>
        <span class="k">if</span> <span class="n">drop_invalids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dropInvalids</span><span class="p">()</span>

<div class="viewcode-block" id="MoleculeTable.save"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the dataset to disk.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="c1"># save descriptor calculator</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">calc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptorCalculators</span><span class="p">):</span>
            <span class="n">calc</span><span class="o">.</span><span class="n">toFile</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptorCalculatorsPathPrefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">calc</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">storePath</span></div>

<div class="viewcode-block" id="MoleculeTable.reload"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.reload">[docs]</a>    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reload the dataset from disk.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reload</span><span class="p">()</span>

        <span class="c1"># load descriptor calculators and tables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptorCalculatorsPathPrefix</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storePrefix</span><span class="si">}</span><span class="s2">_descriptor_calculator&quot;</span>
        <span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storeDir</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptorCalculatorsPathPrefix</span><span class="p">))</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storeDir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>  <span class="c1"># file handle</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;calculator&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="n">calc_cls</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s2">&quot;qsprpred.data.utils.descriptorcalculator.&quot;</span>
                        <span class="s2">&quot;MoleculeDescriptorsCalculator&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">calc_cls</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;calculator&quot;</span><span class="p">]</span>
                <span class="n">calc_cls</span> <span class="o">=</span> <span class="n">import_class</span><span class="p">(</span><span class="n">calc_cls</span><span class="p">)</span>
                <span class="n">calc</span> <span class="o">=</span> <span class="n">calc_cls</span><span class="o">.</span><span class="n">fromFile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">descriptorCalculators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calc</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loadDescriptorsTable</span><span class="p">(</span><span class="n">calc</span><span class="p">))</span></div>

<div class="viewcode-block" id="MoleculeTable.loadDescriptorsTable"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.loadDescriptorsTable">[docs]</a>    <span class="k">def</span> <span class="nf">loadDescriptorsTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DescriptorTable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load a descriptor table from disk.</span>

<span class="sd">        Args:</span>
<span class="sd">            calc (DescriptorsCalculator): Descriptor</span>

<span class="sd">        Returns:</span>
<span class="sd">            DescriptorTable: Descriptor table.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">DescriptorTable</span><span class="p">(</span>
            <span class="n">calc</span><span class="p">,</span>
            <span class="n">name_prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">store_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">storeDir</span><span class="p">,</span>
            <span class="n">n_jobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nJobs</span><span class="p">,</span>
            <span class="n">chunk_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chunkSize</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MoleculeTable.fromFile"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.fromFile">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fromFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MoleculeTable&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a `MoleculeTable` instance from by providing a direct path to the</span>
<span class="sd">        pickled data frame in storage.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): Path to the pickled data frame.</span>
<span class="sd">            *args: Additional arguments to pass to the `MoleculeTable` constructor.</span>
<span class="sd">            **kwargs: Additional keyword arguments to pass to the `MoleculeTable`</span>
<span class="sd">                constructor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">store_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">MoleculeTable</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">store_dir</span><span class="o">=</span><span class="n">store_dir</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>  <span class="c1"># noqa: B026 # FIXME: this is a bug in flake8...</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MoleculeTable.fromSMILES"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.fromSMILES">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fromSMILES</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">smiles</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a `MoleculeTable` instance from a list of SMILES sequences.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the data set.</span>
<span class="sd">            smiles (list): list of SMILES sequences.</span>
<span class="sd">            *args: Additional arguments to pass to the `MoleculeTable` constructor.</span>
<span class="sd">            **kwargs: Additional keyword arguments to pass to the `MoleculeTable`</span>
<span class="sd">                constructor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">smilescol</span> <span class="o">=</span> <span class="s2">&quot;SMILES&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">smilescol</span><span class="p">:</span> <span class="n">smiles</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">MoleculeTable</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">smiles_col</span><span class="o">=</span><span class="n">smilescol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="MoleculeTable.fromTableFile"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.fromTableFile">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fromTableFile</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a `MoleculeTable` instance from a file containing a table of molecules</span>
<span class="sd">        (i.e. a CSV file).</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the data set.</span>
<span class="sd">            filename (str): Path to the file containing the table.</span>
<span class="sd">            sep (str): Separator used in the file for different columns.</span>
<span class="sd">            *args: Additional arguments to pass to the `MoleculeTable` constructor.</span>
<span class="sd">            **kwargs: Additional keyword arguments to pass to the `MoleculeTable`</span>
<span class="sd">                constructor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">MoleculeTable</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="MoleculeTable.fromSDF"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.fromSDF">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fromSDF</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">smiles_prop</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a `MoleculeTable` instance from an SDF file.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the data set.</span>
<span class="sd">            filename (str): Path to the SDF file.</span>
<span class="sd">            smiles_prop (str): Name of the property in the SDF file containing the</span>
<span class="sd">                SMILES sequence.</span>
<span class="sd">            *args: Additional arguments to pass to the `MoleculeTable` constructor.</span>
<span class="sd">            **kwargs: Additional keyword arguments to pass to the `MoleculeTable`</span>
<span class="sd">                constructor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># FIXME: the RDKit mols are always added here, which might be unnecessary</span>
        <span class="k">return</span> <span class="n">MoleculeTable</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">PandasTools</span><span class="o">.</span><span class="n">LoadSDF</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">molColName</span><span class="o">=</span><span class="s2">&quot;RDMol&quot;</span><span class="p">),</span>
            <span class="n">smiles_col</span><span class="o">=</span><span class="n">smiles_prop</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>  <span class="c1"># noqa: B026 # FIXME: this is a bug in flake8...</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MoleculeTable.checkMols"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.checkMols">[docs]</a>    <span class="k">def</span> <span class="nf">checkMols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">throw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a boolean array indicating whether each molecule is valid or not.</span>
<span class="sd">        If `throw` is `True`, an exception is thrown if any molecule is invalid.</span>

<span class="sd">        Args:</span>
<span class="sd">            throw (bool): Whether to throw an exception if any molecule is invalid.</span>

<span class="sd">        Returns:</span>
<span class="sd">            mask (pd.Series): Boolean series indicating whether each molecule is valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nJobs</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nJobs</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span>
                    <span class="n">check_smiles_valid</span><span class="p">,</span>
                    <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">smilesCol</span><span class="p">],</span> <span class="p">[</span><span class="n">throw</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">smilesCol</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">check_smiles_valid</span><span class="p">,</span> <span class="n">throw</span><span class="o">=</span><span class="n">throw</span><span class="p">)</span></div>

<div class="viewcode-block" id="MoleculeTable.dropDescriptors"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.dropDescriptors">[docs]</a>    <span class="k">def</span> <span class="nf">dropDescriptors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calculator</span><span class="p">:</span> <span class="s2">&quot;DescriptorsCalculator&quot;</span><span class="p">):</span>  <span class="c1"># noqa: F821</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Drop descriptors from the data frame that were calculated using a specific</span>
<span class="sd">                calculator.</span>

<span class="sd">                Args:</span>
<span class="sd">                    calculator (DescriptorsCalculator): DescriptorsCalculator object to</span>
<span class="sd">                        use for descriptor calculation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">calc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptorCalculators</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">calc</span><span class="o">.</span><span class="n">getPrefix</span><span class="p">()</span> <span class="o">==</span> <span class="n">calculator</span><span class="o">.</span><span class="n">getPrefix</span><span class="p">():</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;Removing existing descriptors with prefix &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">calculator</span><span class="o">.</span><span class="n">getPrefix</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="n">to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">to_remove</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">clearFiles</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">descriptorCalculators</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div>

<div class="viewcode-block" id="MoleculeTable.addCustomDescriptors"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.addCustomDescriptors">[docs]</a>    <span class="k">def</span> <span class="nf">addCustomDescriptors</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">calculator</span><span class="p">:</span> <span class="s2">&quot;CustomDescriptorsCalculator&quot;</span><span class="p">,</span>  <span class="c1"># noqa: F821</span>
        <span class="n">recalculate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add custom descriptors to the data frame using a `CustomDescriptorsCalculator`</span>
<span class="sd">        object.</span>

<span class="sd">        Args:</span>
<span class="sd">            calculator (CustomDescriptorsCalculator): CustomDescriptorsCalculator object</span>
<span class="sd">                to use for descriptor calculation.</span>
<span class="sd">            recalculate (bool): Whether to recalculate descriptors even if they are</span>
<span class="sd">                already present in the data frame. If `False`, existing descriptors</span>
<span class="sd">                are kept and no calculation takes place.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">recalculate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dropDescriptors</span><span class="p">(</span><span class="n">calculator</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDescriptorNames</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">calculator</span><span class="o">.</span><span class="n">getPrefix</span><span class="p">()):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Custom molecular descriptors already exist in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="s2">&quot;Use `recalculate=True` to overwrite them.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>
        <span class="n">descriptors</span> <span class="o">=</span> <span class="n">calculator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">descriptors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indexCols</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indexCols</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attachDescriptors</span><span class="p">(</span><span class="n">calculator</span><span class="p">,</span> <span class="n">descriptors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexCols</span><span class="p">)</span></div>

<div class="viewcode-block" id="MoleculeTable.attachDescriptors"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.attachDescriptors">[docs]</a>    <span class="k">def</span> <span class="nf">attachDescriptors</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">calculator</span><span class="p">:</span> <span class="s2">&quot;DescriptorsCalculator&quot;</span><span class="p">,</span>  <span class="c1"># noqa: F821</span>
        <span class="n">descriptors</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">index_cols</span><span class="p">:</span> <span class="nb">list</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Attach descriptors to the data frame.</span>

<span class="sd">        Args:</span>
<span class="sd">            calculator (DescriptorsCalculator): DescriptorsCalculator object to use for</span>
<span class="sd">                descriptor calculation.</span>
<span class="sd">            descriptors (pd.DataFrame): DataFrame containing the descriptors to attach.</span>
<span class="sd">            index_cols (list): List of column names to use as index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptorCalculators</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">descriptorCalculators</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptorCalculators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calculator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">DescriptorTable</span><span class="p">(</span>
                <span class="n">calculator</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">descriptors</span><span class="p">,</span>
                <span class="n">store_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">storeDir</span><span class="p">,</span>
                <span class="n">n_jobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nJobs</span><span class="p">,</span>
                <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">key_cols</span><span class="o">=</span><span class="n">index_cols</span><span class="p">,</span>
                <span class="n">chunk_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chunkSize</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MoleculeTable.addDescriptors"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.addDescriptors">[docs]</a>    <span class="k">def</span> <span class="nf">addDescriptors</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">calculator</span><span class="p">:</span> <span class="s2">&quot;MoleculeDescriptorsCalculator&quot;</span><span class="p">,</span>  <span class="c1"># noqa: F821</span>
        <span class="n">recalculate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">fail_on_invalid</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add descriptors to the data frame using a `DescriptorsCalculator` object.</span>

<span class="sd">        Args:</span>
<span class="sd">            calculator (MoleculeDescriptorsCalculator): DescriptorsCalculator object to</span>
<span class="sd">                use for descriptor calculation.</span>
<span class="sd">            recalculate (bool): Whether to recalculate descriptors even if they are</span>
<span class="sd">                already present in the data frame. If `False`, existing descriptors are</span>
<span class="sd">                kept and no calculation takes place.</span>
<span class="sd">            fail_on_invalid (bool): Whether to throw an exception if any molecule</span>
<span class="sd">                is invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">recalculate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dropDescriptors</span><span class="p">(</span><span class="n">calculator</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDescriptorNames</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">calculator</span><span class="o">.</span><span class="n">getPrefix</span><span class="p">()):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Molecular descriptors already exist in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="s2">&quot;Use `recalculate=True` to overwrite them.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">fail_on_invalid</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">checkMols</span><span class="p">(</span><span class="n">throw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cannot add descriptors to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> because it contains one or &quot;</span>
                    <span class="s2">&quot;more invalid molecules. Remove the invalid molecules from your &quot;</span>
                    <span class="s2">&quot;data or try to standardize the data set first with &quot;</span>
                    <span class="s2">&quot;&#39;standardizeSmiles()&#39;. You can also pass &#39;fail_on_invalid=False&#39; &quot;</span>
                    <span class="s2">&quot;to remove this exception, but the calculation might not be &quot;</span>
                    <span class="s2">&quot;successful or correct. See the following list of invalid molecule &quot;</span>
                    <span class="s2">&quot;SMILES for more information:&quot;</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">checkMols</span><span class="p">(</span><span class="n">throw</span><span class="o">=</span><span class="kc">False</span><span class="p">)][</span><span class="bp">self</span><span class="o">.</span><span class="n">smilesCol</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="n">exp</span>
        <span class="c1"># get the data frame with the descriptors</span>
        <span class="n">descriptors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="n">calculator</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">smilesCol</span><span class="p">],</span> <span class="n">result_type</span><span class="o">=</span><span class="s2">&quot;reduce&quot;</span>
        <span class="p">)</span>
        <span class="n">descriptors</span> <span class="o">=</span> <span class="n">descriptors</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="n">descriptors</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">descriptors</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">descriptors</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span>
        <span class="n">descriptors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indexCols</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indexCols</span><span class="p">]</span>
        <span class="c1"># add the descriptors to the descriptor list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attachDescriptors</span><span class="p">(</span><span class="n">calculator</span><span class="p">,</span> <span class="n">descriptors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexCols</span><span class="p">)</span></div>

<div class="viewcode-block" id="MoleculeTable.getDescriptors"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.getDescriptors">[docs]</a>    <span class="k">def</span> <span class="nf">getDescriptors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the subset of the data frame that contains only descriptors.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Data frame containing only descriptors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">join_cols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">descriptors</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="p">:</span>
            <span class="n">join_cols</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">descriptors</span><span class="o">.</span><span class="n">keyCols</span><span class="p">))</span>
        <span class="n">join_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">join_cols</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">join_cols</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">descriptors</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="p">:</span>
            <span class="n">df_descriptors</span> <span class="o">=</span> <span class="n">descriptors</span><span class="o">.</span><span class="n">getDF</span><span class="p">()</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="n">df_descriptors</span><span class="p">,</span>
                <span class="n">left_on</span><span class="o">=</span><span class="n">descriptors</span><span class="o">.</span><span class="n">keyCols</span><span class="p">,</span>
                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
                <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;_left&quot;</span><span class="p">,</span> <span class="s2">&quot;_right&quot;</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">descriptors</span><span class="o">.</span><span class="n">keyCols</span><span class="p">:</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">_right&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">_left&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">join_cols</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="MoleculeTable.getDescriptorNames"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.getDescriptorNames">[docs]</a>    <span class="k">def</span> <span class="nf">getDescriptorNames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the names of the descriptors in the data frame.</span>

<span class="sd">        Args:</span>
<span class="sd">            prefix (str): Prefix of the descriptors to get. If `None`, all descriptors</span>
<span class="sd">                are returned.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: list of descriptor names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">prefix</span><span class="p">:</span>
            <span class="n">prefixes</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">getPrefix</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptorCalculators</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptorCalculators</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prefixes</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="p">:</span>
            <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">prefixes</span><span class="p">:</span>
                <span class="n">names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">getDescriptorNames</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">names</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hasDescriptors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether the data frame contains descriptors.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDescriptorNames</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span>

<div class="viewcode-block" id="MoleculeTable.getProperties"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.getProperties">[docs]</a>    <span class="k">def</span> <span class="nf">getProperties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get names of all properties/variables saved in the data frame (all columns).</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: list of property names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span></div>

<div class="viewcode-block" id="MoleculeTable.hasProperty"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.hasProperty">[docs]</a>    <span class="k">def</span> <span class="nf">hasProperty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether a property is present in the data frame.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the property.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether the property is present.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span></div>

<div class="viewcode-block" id="MoleculeTable.addProperty"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.addProperty">[docs]</a>    <span class="k">def</span> <span class="nf">addProperty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a property to the data frame.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the property.</span>
<span class="sd">            data (list): list of property values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span></div>

<div class="viewcode-block" id="MoleculeTable.removeProperty"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.removeProperty">[docs]</a>    <span class="k">def</span> <span class="nf">removeProperty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a property from the data frame.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the property to delete.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_scaffold_calculator</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">scaffold</span><span class="p">:</span> <span class="n">Scaffold</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Just a helper function to calculate the scaffold of a molecule more easily.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">scaffold</span><span class="p">(</span><span class="n">mol</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<div class="viewcode-block" id="MoleculeTable.addScaffolds"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.addScaffolds">[docs]</a>    <span class="k">def</span> <span class="nf">addScaffolds</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">scaffolds</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Scaffold</span><span class="p">],</span>
        <span class="n">add_rdkit_scaffold</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">recalculate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add scaffolds to the data frame.</span>

<span class="sd">        A new column is created that contains the SMILES of the corresponding scaffold.</span>
<span class="sd">        If `add_rdkit_scaffold` is set to `True`, a new column is created that contains</span>
<span class="sd">        the RDKit scaffold of the corresponding molecule.</span>

<span class="sd">        Args:</span>
<span class="sd">            scaffolds (list): list of `Scaffold` calculators.</span>
<span class="sd">            add_rdkit_scaffold (bool): Whether to add the RDKit scaffold of the molecule</span>
<span class="sd">                as a new column.</span>
<span class="sd">            recalculate (bool): Whether to recalculate scaffolds even if they are</span>
<span class="sd">                already present in the data frame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">scaffold</span> <span class="ow">in</span> <span class="n">scaffolds</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">recalculate</span> <span class="ow">and</span> <span class="sa">f</span><span class="s2">&quot;Scaffold_</span><span class="si">{</span><span class="n">scaffold</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Scaffold_</span><span class="si">{</span><span class="n">scaffold</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scaffold_calculator</span><span class="p">,</span>
                <span class="n">func_args</span><span class="o">=</span><span class="p">(</span><span class="n">scaffold</span><span class="p">,</span> <span class="p">),</span>
                <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">smilesCol</span><span class="p">],</span>
                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">raw</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">add_rdkit_scaffold</span><span class="p">:</span>
                <span class="n">PandasTools</span><span class="o">.</span><span class="n">AddMoleculeColumnToFrame</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span>
                    <span class="n">smilesCol</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Scaffold_</span><span class="si">{</span><span class="n">scaffold</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">molCol</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Scaffold_</span><span class="si">{</span><span class="n">scaffold</span><span class="si">}</span><span class="s2">_RDMol&quot;</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="MoleculeTable.getScaffoldNames"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.getScaffoldNames">[docs]</a>    <span class="k">def</span> <span class="nf">getScaffoldNames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_mols</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the names of the scaffolds in the data frame.</span>

<span class="sd">        Args:</span>
<span class="sd">            include_mols (bool): Whether to include the RDKit scaffold columns as well.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: List of scaffold names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Scaffold_&quot;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="p">(</span><span class="n">include_mols</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">col</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_RDMol&quot;</span><span class="p">))</span>
        <span class="p">]</span></div>

<div class="viewcode-block" id="MoleculeTable.getScaffolds"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.getScaffolds">[docs]</a>    <span class="k">def</span> <span class="nf">getScaffolds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">includeMols</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the subset of the data frame that contains only scaffolds.</span>

<span class="sd">        Args:</span>
<span class="sd">            includeMols (bool): Whether to include the RDKit scaffold columns as well.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Data frame containing only scaffolds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">includeMols</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[[</span>
                <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Scaffold_&quot;</span><span class="p">)</span>
            <span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getScaffoldNames</span><span class="p">()]</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hasScaffolds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether the data frame contains scaffolds.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether the data frame contains scaffolds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getScaffoldNames</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span>

<div class="viewcode-block" id="MoleculeTable.createScaffoldGroups"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.createScaffoldGroups">[docs]</a>    <span class="k">def</span> <span class="nf">createScaffoldGroups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mols_per_group</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create scaffold groups.</span>

<span class="sd">        A scaffold group is a list of molecules that share the same scaffold. New</span>
<span class="sd">        columns are created that contain the scaffold group ID and the scaffold group</span>
<span class="sd">        size.</span>

<span class="sd">        Args:</span>
<span class="sd">            mols_per_group (int): Number of molecules per scaffold group.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scaffolds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getScaffolds</span><span class="p">(</span><span class="n">includeMols</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">scaffold</span> <span class="ow">in</span> <span class="n">scaffolds</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">scaffold</span><span class="p">])</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="n">mols_per_group</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ScaffoldGroup_</span><span class="si">{</span><span class="n">scaffold</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">mols_per_group</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">scaffold</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">),</span>
                    <span class="s2">&quot;Other&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">scaffold</span><span class="p">],</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="MoleculeTable.getScaffoldGroups"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.getScaffoldGroups">[docs]</a>    <span class="k">def</span> <span class="nf">getScaffoldGroups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scaffold_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mol_per_group</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the scaffold groups for a given combination of scaffold and number of</span>
<span class="sd">        molecules per scaffold group.</span>

<span class="sd">        Args:</span>
<span class="sd">            scaffold_name (str): Name of the scaffold.</span>
<span class="sd">            mol_per_group (int): Number of molecules per scaffold group.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: list of scaffold groups.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;ScaffoldGroup_</span><span class="si">{</span><span class="n">scaffold_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">mol_per_group</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)][</span><span class="mi">0</span><span class="p">]]</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hasScaffoldGroups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether the data frame contains scaffold groups.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether the data frame contains scaffold groups.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">([</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ScaffoldGroup_&quot;</span><span class="p">)])</span>
            <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">)</span>

<div class="viewcode-block" id="MoleculeTable.standardizeSmiles"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.standardizeSmiles">[docs]</a>    <span class="k">def</span> <span class="nf">standardizeSmiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">smiles_standardizer</span><span class="p">,</span> <span class="n">drop_invalid</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply smiles_standardizer to the compounds in parallel</span>

<span class="sd">        Args:</span>
<span class="sd">            smiles_standardizer (): either `None` to skip the</span>
<span class="sd">                standardization, `chembl`, `old`, or a partial function that reads</span>
<span class="sd">                and standardizes smiles.</span>
<span class="sd">            drop_invalid (bool): whether to drop invalid SMILES from the data set.</span>
<span class="sd">                Defaults to `True`. If `False`, invalid SMILES will be retained in</span>
<span class="sd">                their original form.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: when smiles_standardizer is not a callable or one of the</span>
<span class="sd">                predefined strings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">std_jobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nJobs</span>
        <span class="k">if</span> <span class="n">smiles_standardizer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">smiles_standardizer</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>  <span class="c1"># Prevents weird error if the user inputs a lambda function</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">smiles_standardizer</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">pickle</span><span class="o">.</span><span class="n">PicklingError</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Standardizer is not pickleable. Will set n_jobs to 1&quot;</span><span class="p">)</span>
                <span class="n">std_jobs</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">std_func</span> <span class="o">=</span> <span class="n">smiles_standardizer</span>
        <span class="k">elif</span> <span class="n">smiles_standardizer</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;chembl&quot;</span><span class="p">:</span>
            <span class="n">std_func</span> <span class="o">=</span> <span class="n">chembl_smi_standardizer</span>
        <span class="k">elif</span> <span class="n">smiles_standardizer</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;old&quot;</span><span class="p">:</span>
            <span class="n">std_func</span> <span class="o">=</span> <span class="n">old_standardize_sanitize</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Standardizer must be either &#39;chembl&#39;, or a callable&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">std_jobs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">std_smi</span> <span class="o">=</span> <span class="p">[</span><span class="n">std_func</span><span class="p">(</span><span class="n">smi</span><span class="p">)</span> <span class="k">for</span> <span class="n">smi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">smilesCol</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">std_jobs</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
                <span class="n">std_smi</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">std_func</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">smilesCol</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">smilesCol</span><span class="p">]</span> <span class="o">=</span> <span class="n">std_smi</span>
        <span class="k">if</span> <span class="n">drop_invalid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dropInvalids</span><span class="p">()</span></div>

<div class="viewcode-block" id="MoleculeTable.dropInvalids"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.MoleculeTable.dropInvalids">[docs]</a>    <span class="k">def</span> <span class="nf">dropInvalids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Drops invalid molecules from the data set.</span>

<span class="sd">        Returns:</span>
<span class="sd">            mask (pd.Series): Boolean mask of invalid molecules in the original</span>
<span class="sd">                data set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">invalid_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkMols</span><span class="p">(</span><span class="n">throw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">~</span><span class="n">invalid_mask</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">invalids</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">invalid_mask</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">invalids</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dropped </span><span class="si">{</span><span class="n">invalids</span><span class="si">}</span><span class="s2"> invalid molecules from the data set.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">~</span><span class="n">invalid_mask</span></div></div>


<div class="viewcode-block" id="TargetProperty"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.TargetProperty">[docs]</a><span class="k">class</span> <span class="nc">TargetProperty</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Target property for QSPRmodelling class.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        name (str): name of the target property</span>
<span class="sd">        task (Literal[TargetTasks.REGRESSION,</span>
<span class="sd">              TargetTasks.SINGLECLASS,</span>
<span class="sd">              TargetTasks.MULTICLASS]): task type for the target property</span>
<span class="sd">        th (int): threshold for the target property, only used for classification tasks</span>
<span class="sd">        nClasses (int): number of classes for the target property, only used for</span>
<span class="sd">            classification tasks</span>
<span class="sd">        transformer (Callable): function to transform the target property</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">task</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="n">TargetTasks</span><span class="o">.</span><span class="n">REGRESSION</span><span class="p">,</span> <span class="n">TargetTasks</span><span class="o">.</span><span class="n">SINGLECLASS</span><span class="p">,</span>
                      <span class="n">TargetTasks</span><span class="o">.</span><span class="n">MULTICLASS</span><span class="p">],</span>
        <span class="n">original_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">th</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">n_classes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">transformer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a TargetProperty object.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): name of the target property</span>
<span class="sd">            task (Literal[TargetTasks.REGRESSION,</span>
<span class="sd">              TargetTasks.SINGLECLASS,</span>
<span class="sd">              TargetTasks.MULTICLASS]): task type for the target property</span>
<span class="sd">            original_name (str): original name of the target property, if not specified,</span>
<span class="sd">                the name is used</span>
<span class="sd">            th (list[float] | str): threshold for the target property, only used</span>
<span class="sd">                for classification tasks</span>
<span class="sd">            n_classes (int): number of classes for the target property (only used if th</span>
<span class="sd">                is precomputed, otherwise it is inferred)</span>
<span class="sd">            transformer (Callable): function to transform the target property</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">originalName</span> <span class="o">=</span> <span class="n">original_name</span> <span class="k">if</span> <span class="n">original_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">=</span> <span class="n">task</span>
        <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">isClassification</span><span class="p">():</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">th</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Threshold not specified for classification task </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">th</span> <span class="o">=</span> <span class="n">th</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">th</span> <span class="o">==</span> <span class="s2">&quot;precomputed&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nClasses</span> <span class="o">=</span> <span class="n">n_classes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span> <span class="o">=</span> <span class="n">transformer</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">th</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the threshold for the target property.</span>

<span class="sd">        Args:</span>
<span class="sd">            th (Union[list[int], str]): threshold for the target property</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_th</span>

    <span class="nd">@th</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">th</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">th</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the threshold for the target property and the number of classes if th is</span>
<span class="sd">        not precomputed.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">isClassification</span><span class="p">()</span>
        <span class="p">),</span> <span class="s2">&quot;Threshold can only be set for classification tasks&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_th</span> <span class="o">=</span> <span class="n">th</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">th</span> <span class="o">==</span> <span class="s2">&quot;precomputed&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Invalid threshold </span><span class="si">{</span><span class="n">th</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_nClasses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">th</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">th</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">2</span>

    <span class="nd">@th</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span> <span class="nf">th</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete the threshold for the target property and the number of classes.&quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_th</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nClasses</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nClasses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the number of classes for the target property.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nClasses</span>

    <span class="nd">@nClasses</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">nClasses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nClasses</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the number of classes for the target property if th is precomputed.</span>

<span class="sd">        Args:</span>
<span class="sd">            nClasses (int): number of classes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">th</span> <span class="o">==</span> <span class="s2">&quot;precomputed&quot;</span>
        <span class="p">),</span> <span class="s2">&quot;Number of classes can only be set if threshold is precomputed&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nClasses</span> <span class="o">=</span> <span class="n">nClasses</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Representation of the TargetProperty object.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">isClassification</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">th</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;TargetProperty(name=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, task=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="si">}</span><span class="s2">, th=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">th</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;TargetProperty(name=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, task=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return string identifier of the TargetProperty object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

<div class="viewcode-block" id="TargetProperty.fromDict"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.TargetProperty.fromDict">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">fromDict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a TargetProperty object from a dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            d (dict): dictionary containing the target property information</span>
<span class="sd">            task_from_str (bool): whether to convert the task from a string</span>

<span class="sd">        Returns:</span>
<span class="sd">            TargetProperty: TargetProperty object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;task&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">TargetProperty</span><span class="p">(</span>
                <span class="o">**</span><span class="p">{</span>
                    <span class="n">k</span><span class="p">:</span> <span class="n">TargetTasks</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;task&quot;</span> <span class="k">else</span> <span class="n">v</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">TargetProperty</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span></div>

<div class="viewcode-block" id="TargetProperty.fromList"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.TargetProperty.fromList">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">fromList</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">task_from_str</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a list of TargetProperty objects from a list of dictionaries.</span>

<span class="sd">        Args:</span>
<span class="sd">            _list (list): list of dictionaries containing the target property</span>
<span class="sd">                information</span>
<span class="sd">            task_from_str (bool): whether to convert the task from a string</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[TargetProperty]: list of TargetProperty objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">task_from_str</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">TargetProperty</span><span class="p">(</span>
                    <span class="o">**</span><span class="p">{</span>
                        <span class="n">k</span><span class="p">:</span> <span class="n">TargetTasks</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;task&quot;</span> <span class="k">else</span> <span class="n">v</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="p">}</span>
                <span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">_list</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">TargetProperty</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">_list</span><span class="p">]</span></div>

<div class="viewcode-block" id="TargetProperty.toList"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.TargetProperty.toList">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">toList</span><span class="p">(</span><span class="n">_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">task_as_str</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">drop_transformer</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a list of TargetProperty objects to a list of dictionaries.</span>

<span class="sd">        Args:</span>
<span class="sd">            _list (list): list of TargetProperty objects</span>
<span class="sd">            task_as_str (bool): whether to convert the task to a string</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict]: list of dictionaries containing the target property information</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">target_props</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">target_prop</span> <span class="ow">in</span> <span class="n">_list</span><span class="p">:</span>
            <span class="n">target_props</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">target_prop</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="s2">&quot;task&quot;</span><span class="p">:</span> <span class="n">target_prop</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">task_as_str</span> <span class="k">else</span> <span class="n">target_prop</span><span class="o">.</span><span class="n">task</span><span class="p">,</span>
                    <span class="s2">&quot;original_name&quot;</span><span class="p">:</span> <span class="n">target_prop</span><span class="o">.</span><span class="n">originalName</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">target_prop</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">isClassification</span><span class="p">():</span>
                <span class="n">target_props</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;th&quot;</span><span class="p">:</span> <span class="n">target_prop</span><span class="o">.</span><span class="n">th</span><span class="p">,</span>
                        <span class="s2">&quot;n_classes&quot;</span><span class="p">:</span> <span class="n">target_prop</span><span class="o">.</span><span class="n">nClasses</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">drop_transformer</span><span class="p">:</span>
                <span class="n">target_props</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;transformer&quot;</span><span class="p">:</span> <span class="n">target_prop</span><span class="o">.</span><span class="n">transformer</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">target_props</span></div>

<div class="viewcode-block" id="TargetProperty.selectFromList"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.TargetProperty.selectFromList">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">selectFromList</span><span class="p">(</span><span class="n">_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">names</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">original_names</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select a subset of TargetProperty objects from a list of TargetProperty</span>
<span class="sd">        objects.</span>

<span class="sd">        Args:</span>
<span class="sd">            _list (list): list of TargetProperty objects</span>
<span class="sd">            names (list): list of names of the target properties to be selected</span>
<span class="sd">            original_names (bool): whether to use the original names of the target</span>
<span class="sd">                properties</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[TargetProperty]: list of TargetProperty objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">original_names</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">_list</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">originalName</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">_list</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span></div>

<div class="viewcode-block" id="TargetProperty.getNames"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.TargetProperty.getNames">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">getNames</span><span class="p">(</span><span class="n">_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the names of the target properties from a list of TargetProperty objects.</span>

<span class="sd">        Args:</span>
<span class="sd">            _list (list): list of TargetProperty objects</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[str]: list of names of the target properties</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">_list</span><span class="p">]</span></div>

<div class="viewcode-block" id="TargetProperty.getOriginalNames"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.TargetProperty.getOriginalNames">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">getOriginalNames</span><span class="p">(</span><span class="n">_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the original names of the target properties from a list of TargetProperty</span>
<span class="sd">        objects.</span>

<span class="sd">        Args:</span>
<span class="sd">            _list (list): list of TargetProperty objects</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[str]: list of original names of the target properties</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">originalName</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">_list</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="QSPRDataset"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset">[docs]</a><span class="k">class</span> <span class="nc">QSPRDataset</span><span class="p">(</span><span class="n">MoleculeTable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prepare dataset for QSPR model training.</span>

<span class="sd">    It splits the data in train and test set, as well as creating cross-validation</span>
<span class="sd">    folds. Optionally low quality data is filtered out. For classification the dataset</span>
<span class="sd">    samples are labelled as active/inactive.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        targetProperties (str) : property to be predicted with QSPRmodel</span>
<span class="sd">        df (pd.dataframe) : dataset</span>
<span class="sd">        X (np.ndarray/pd.DataFrame) : m x n feature matrix for cross validation, where m</span>
<span class="sd">            is the number of samplesand n is the number of features.</span>
<span class="sd">        y (np.ndarray/pd.DataFrame) : m-d label array for cross validation, where m is</span>
<span class="sd">            the number of samples and equals to row of X.</span>
<span class="sd">        X_ind (np.ndarray/pd.DataFrame) : m x n Feature matrix for independent set,</span>
<span class="sd">            where m is the number of samples and n is the number of features.</span>
<span class="sd">        y_ind (np.ndarray/pd.DataFrame) : m-l label array for independent set, where m</span>
<span class="sd">            is the number of samples and equals to row of X_ind, and l is the number of</span>
<span class="sd">            types.</span>
<span class="sd">        featureNames (list of str) : feature names</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">target_props</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">TargetProperty</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">],</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">smiles_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;SMILES&quot;</span><span class="p">,</span>
        <span class="n">add_rdkit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">store_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">drop_invalids</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">drop_empty</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">target_imputer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">index_cols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct QSPRdata, also apply transformations of output property if</span>
<span class="sd">        specified.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): data name, used in saving the data</span>
<span class="sd">            target_props (list[TargetProperty | dict]): target properties, names</span>
<span class="sd">                should correspond with target columnname in df</span>
<span class="sd">            df (pd.DataFrame, optional): input dataframe containing smiles and target</span>
<span class="sd">                property. Defaults to None.</span>
<span class="sd">            smiles_col (str, optional): name of column in df containing SMILES.</span>
<span class="sd">                Defaults to &quot;SMILES&quot;.</span>
<span class="sd">            add_rdkit (bool, optional): if true, column with rdkit molecules will be</span>
<span class="sd">                added to df. Defaults to False.</span>
<span class="sd">            store_dir (str, optional): directory for saving the output data.</span>
<span class="sd">                Defaults to &#39;.&#39;.</span>
<span class="sd">            overwrite (bool, optional): if already saved data at output dir if should</span>
<span class="sd">                be overwritten. Defaults to False.</span>
<span class="sd">            n_jobs (int, optional): number of parallel jobs. If &lt;= 0, all available</span>
<span class="sd">                cores will be used. Defaults to 1.</span>
<span class="sd">            chunk_size (int, optional): chunk size for parallel processing.</span>
<span class="sd">                Defaults to 50.</span>
<span class="sd">            drop_invalids (bool, optional): if true, invalid SMILES will be dropped.</span>
<span class="sd">                Defaults to True.</span>
<span class="sd">            drop_empty (bool, optional): if true, rows with empty target property will</span>
<span class="sd">                be removed.</span>
<span class="sd">            target_imputer (Callable, optional): imputer for missing target property</span>
<span class="sd">                values. Defaults to None.</span>
<span class="sd">            index_cols (list[str], optional): columns to be used as index in the</span>
<span class="sd">                dataframe. Defaults to `None` in which case a custom ID will be</span>
<span class="sd">                generated.</span>

<span class="sd">        Raises:</span>
<span class="sd">            `ValueError`: Raised if threshold given with non-classification task.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">smiles_col</span><span class="p">,</span> <span class="n">add_rdkit</span><span class="p">,</span> <span class="n">store_dir</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">,</span> <span class="n">n_jobs</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">,</span>
            <span class="n">drop_invalids</span><span class="p">,</span> <span class="n">index_cols</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span> <span class="o">=</span> <span class="n">QSPRDataset</span><span class="o">.</span><span class="n">loadMetadata</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">store_dir</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># load names of descriptors to use as training features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featureNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFeatureNames</span><span class="p">()</span>
        <span class="c1"># load target properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTargetProperties</span><span class="p">(</span><span class="n">target_props</span><span class="p">,</span> <span class="n">drop_empty</span><span class="p">,</span> <span class="n">target_imputer</span><span class="p">)</span>
        <span class="c1"># load standardizers for features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_standardizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadFeatureStandardizer</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_standardizer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feature_standardizer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fold_generator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDefaultFoldGenerator</span><span class="p">()</span>
        <span class="c1"># populate feature matrix and target property array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_ind</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restoreTrainingData</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Dataset &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; created for target &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;targetProperties: &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">targetProperties</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span>

<div class="viewcode-block" id="QSPRDataset.fromTableFile"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.fromTableFile">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fromTableFile</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Create QSPRDataset from table file (i.e. CSV or TSV).</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): name of the data set</span>
<span class="sd">            filename (str): path to the table file</span>
<span class="sd">            sep (str, optional): separator in the table file. Defaults to &quot;\t&quot;.</span>
<span class="sd">            *args: additional arguments for QSPRDataset constructor</span>
<span class="sd">            **kwargs: additional keyword arguments for QSPRDataset constructor</span>
<span class="sd">        Returns:</span>
<span class="sd">            QSPRDataset: `QSPRDataset` object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">QSPRDataset</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">),</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>  <span class="c1"># noqa: B026 # FIXME: this is a bug in flake8...</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="QSPRDataset.fromSDF"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.fromSDF">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fromSDF</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">smiles_prop</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create QSPRDataset from SDF file.</span>

<span class="sd">        It is currently not implemented for QSPRDataset, but you can convert from</span>
<span class="sd">        &#39;MoleculeTable&#39; with the &#39;fromMolTable&#39; method.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): name of the data set</span>
<span class="sd">            filename (str): path to the SDF file</span>
<span class="sd">            smiles_prop (str): name of the property in the SDF file containing SMILES</span>
<span class="sd">            *args: additional arguments for QSPRDataset constructor</span>
<span class="sd">            **kwargs: additional keyword arguments for QSPRDataset constructor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;SDF loading not implemented for </span><span class="si">{</span><span class="n">QSPRDataset</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">, yet. You can &quot;</span>
            <span class="s2">&quot;convert from &#39;MoleculeTable&#39; with &#39;fromMolTable&#39;.&quot;</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="QSPRDataset.setTargetProperties"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.setTargetProperties">[docs]</a>    <span class="k">def</span> <span class="nf">setTargetProperties</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">target_props</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">TargetProperty</span><span class="p">],</span>
        <span class="n">drop_empty</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">target_imputer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set list of target properties and apply transformations if specified.</span>

<span class="sd">        Args:</span>
<span class="sd">            target_props (list[TargetProperty]): list of target properties</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check target properties validity</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_props</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="p">(</span>
            <span class="s2">&quot;target_props should be a list of TargetProperty objects or dictionaries &quot;</span>
            <span class="s2">&quot;initialize TargetProperties from.&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_props</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">target_props</span><span class="p">),</span> <span class="p">(</span>
                <span class="s2">&quot;target_props should be a list of TargetProperty objects or &quot;</span>
                <span class="s2">&quot;dictionaries to initialize TargetProperties from, not a mix.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">targetProperties</span> <span class="o">=</span> <span class="n">TargetProperty</span><span class="o">.</span><span class="n">fromList</span><span class="p">(</span><span class="n">target_props</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">TargetProperty</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">target_props</span><span class="p">),</span> <span class="p">(</span>
                <span class="s2">&quot;target_props should be a list of TargetProperty objects or &quot;</span>
                <span class="s2">&quot;dictionaries to initialize TargetProperties from, not a mix.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">targetProperties</span> <span class="o">=</span> <span class="n">target_props</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">prop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetPropertyNames</span>
        <span class="p">),</span> <span class="s2">&quot;Not all target properties in dataframe columns.&quot;</span>
        <span class="c1"># transform target properties</span>
        <span class="k">for</span> <span class="n">target_prop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetProperties</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">target_prop</span><span class="o">.</span><span class="n">transformer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">transformed_prop</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">target_prop</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_transformed&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">target_prop</span><span class="o">.</span><span class="n">name</span><span class="p">],</span>
                    <span class="n">target_prop</span><span class="o">.</span><span class="n">transformer</span><span class="p">,</span>
                    <span class="n">addAs</span><span class="o">=</span><span class="p">[</span><span class="n">transformed_prop</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">target_prop</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">transformed_prop</span>
        <span class="c1"># drop rows with missing smiles/no target property for any of</span>
        <span class="c1"># the target properties</span>
        <span class="k">if</span> <span class="n">drop_empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dropEmpty</span><span class="p">()</span>
        <span class="c1"># impute missing target property values</span>
        <span class="k">if</span> <span class="n">target_imputer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imputeTargetProperties</span><span class="p">(</span><span class="n">target_imputer</span><span class="p">)</span>
        <span class="c1"># convert classification targets to integers</span>
        <span class="k">for</span> <span class="n">target_prop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetProperties</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">target_prop</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">isClassification</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">makeClassification</span><span class="p">(</span><span class="n">target_prop</span><span class="p">)</span></div>

<div class="viewcode-block" id="QSPRDataset.dropEmpty"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.dropEmpty">[docs]</a>    <span class="k">def</span> <span class="nf">dropEmpty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Drop rows with empty target property value from the data set.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">smilesCol</span><span class="p">]),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targetPropertyNames</span><span class="p">),</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="QSPRDataset.imputeTargetProperties"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.imputeTargetProperties">[docs]</a>    <span class="k">def</span> <span class="nf">imputeTargetProperties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imputer</span><span class="p">:</span> <span class="n">Callable</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Impute missing target property values.</span>

<span class="sd">        Args:</span>
<span class="sd">            imputer (Callable): imputer object, should have a fit and transform method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetPropertyNames</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">target_prop</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targetProperties</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">targetProperties</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">target_prop</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_imputed&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">targetPropertyNames</span><span class="p">]</span> <span class="o">=</span> <span class="n">imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">names</span><span class="p">])</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hasFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether the currently selected set of features is not empty.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featureNames</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featureNames</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>

<div class="viewcode-block" id="QSPRDataset.getFeatureNames"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.getFeatureNames">[docs]</a>    <span class="k">def</span> <span class="nf">getFeatureNames</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get current feature names for this data set.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[str]: list of feature names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">features</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasDescriptors</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDescriptorNames</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptorCalculators</span><span class="p">:</span>
            <span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">calc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptorCalculators</span><span class="p">:</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="n">calc</span><span class="o">.</span><span class="n">getPrefix</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">descset</span> <span class="ow">in</span> <span class="n">calc</span><span class="o">.</span><span class="n">descSets</span><span class="p">:</span>
                    <span class="n">features</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">descset</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">descset</span><span class="o">.</span><span class="n">descriptors</span><span class="p">]</span>
                    <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">features</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;feature_names&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">)</span> <span class="ow">and</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">[</span><span class="s2">&quot;feature_names&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">features</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">[</span><span class="s2">&quot;feature_names&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">features</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">features</span></div>

<div class="viewcode-block" id="QSPRDataset.restoreTrainingData"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.restoreTrainingData">[docs]</a>    <span class="k">def</span> <span class="nf">restoreTrainingData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Restore training data from the data frame.</span>

<span class="sd">        If the data frame contains a column &#39;Split_IsTrain&#39;,</span>
<span class="sd">        the data will be split into training and independent sets. Otherwise, the</span>
<span class="sd">            independent set will</span>
<span class="sd">        be empty. If descriptors are available, the resulting training matrices will</span>
<span class="sd">            be featurized.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadDataToSplits</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featurizeSplits</span><span class="p">()</span></div>

<div class="viewcode-block" id="QSPRDataset.makeRegression"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.makeRegression">[docs]</a>    <span class="k">def</span> <span class="nf">makeRegression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_property</span><span class="p">:</span> <span class="n">TargetProperty</span> <span class="o">|</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Switch to regression task using the given target property.</span>

<span class="sd">        Args:</span>
<span class="sd">            target_property (str): name of the target property to use for regression</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_property</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">target_property</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTargetProperties</span><span class="p">(</span>
                <span class="p">[</span><span class="n">target_property</span><span class="p">],</span> <span class="n">original_names</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">target_property</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">target_property</span><span class="o">.</span><span class="n">originalName</span>
        <span class="n">target_property</span><span class="o">.</span><span class="n">task</span> <span class="o">=</span> <span class="n">TargetTasks</span><span class="o">.</span><span class="n">REGRESSION</span>
        <span class="k">del</span> <span class="n">target_property</span><span class="o">.</span><span class="n">th</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restoreTrainingData</span><span class="p">()</span></div>

<div class="viewcode-block" id="QSPRDataset.makeClassification"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.makeClassification">[docs]</a>    <span class="k">def</span> <span class="nf">makeClassification</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">target_property</span><span class="p">:</span> <span class="n">TargetProperty</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">th</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Switch to classification task using the given threshold values.</span>

<span class="sd">        Args:</span>
<span class="sd">            target_property (TargetProperty): Target property to use for classification</span>
<span class="sd">                or name of the target property.</span>
<span class="sd">            th (list[float], optional): list of threshold values. If not provided, the</span>
<span class="sd">                values will be inferred from th specified in TargetProperty.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">th</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="n">th</span> <span class="o">==</span> <span class="s2">&quot;precomputed&quot;</span>
            <span class="p">),</span> <span class="s2">&quot;Threshold values should be provided as a list of floats.&quot;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="p">),</span> <span class="s2">&quot;Threshold values should be provided as a list of floats.&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_property</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">target_property</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTargetProperties</span><span class="p">(</span>
                <span class="p">[</span><span class="n">target_property</span><span class="p">],</span> <span class="n">original_names</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># check if the column only has nan values</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">target_property</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Target property </span><span class="si">{</span><span class="n">target_property</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="s2">&quot; is all nan, assuming predictor.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">target_property</span>

        <span class="c1"># if no threshold values provided, use the ones specified in the TargetProperty</span>
        <span class="k">if</span> <span class="n">th</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">target_property</span><span class="p">,</span> <span class="s2">&quot;th&quot;</span><span class="p">),</span> <span class="p">(</span>
                <span class="s2">&quot;Target property does not have a threshold attribute and &quot;</span>
                <span class="s2">&quot;no threshold specified in function args.&quot;</span>
            <span class="p">)</span>
            <span class="n">th</span> <span class="o">=</span> <span class="n">target_property</span><span class="o">.</span><span class="n">th</span>

        <span class="n">new_prop</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">target_property</span><span class="o">.</span><span class="n">originalName</span><span class="si">}</span><span class="s2">_class&quot;</span>

        <span class="k">if</span> <span class="n">th</span> <span class="o">==</span> <span class="s2">&quot;precomputed&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">new_prop</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">target_property</span><span class="o">.</span><span class="n">originalName</span><span class="p">]</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
                <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">bool</span><span class="p">))</span> <span class="ow">or</span>
                <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">is_integer</span><span class="p">())</span>
                <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">new_prop</span><span class="p">]</span>
            <span class="p">),</span> <span class="s2">&quot;Precomputed classification target must be integers or booleans.&quot;</span>
            <span class="n">nClasses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">new_prop</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
            <span class="n">target_property</span><span class="o">.</span><span class="n">task</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">TargetTasks</span><span class="o">.</span><span class="n">MULTICLASS</span> <span class="k">if</span> <span class="n">nClasses</span> <span class="o">&gt;</span> <span class="mi">2</span>  <span class="c1"># noqa: PLR2004</span>
                <span class="k">else</span> <span class="n">TargetTasks</span><span class="o">.</span><span class="n">SINGLECLASS</span>
            <span class="p">)</span>
            <span class="n">target_property</span><span class="o">.</span><span class="n">th</span> <span class="o">=</span> <span class="n">th</span>
            <span class="n">target_property</span><span class="o">.</span><span class="n">nClasses</span> <span class="o">=</span> <span class="n">nClasses</span>
            <span class="n">target_property</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">new_prop</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Threshold list must contain at least one value.&quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span>  <span class="c1"># noqa: PLR2004c</span>
                       <span class="p">),</span> <span class="p">(</span>
                           <span class="s2">&quot;For multi-class classification, &quot;</span>
                           <span class="s2">&quot;set more than 3 values as threshold.&quot;</span>
                       <span class="p">)</span>
                <span class="k">assert</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">target_property</span><span class="o">.</span><span class="n">originalName</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="p">(</span>
                    <span class="s2">&quot;Make sure final threshold value is not smaller &quot;</span>
                    <span class="s2">&quot;than largest value of property&quot;</span>
                <span class="p">)</span>
                <span class="k">assert</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">target_property</span><span class="o">.</span><span class="n">originalName</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="nb">min</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="p">(</span>
                    <span class="s2">&quot;Make sure first threshold value is not larger &quot;</span>
                    <span class="s2">&quot;than smallest value of property&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_prop</span><span class="si">}</span><span class="s2">_intervals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">target_property</span><span class="o">.</span><span class="n">originalName</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">th</span><span class="p">,</span> <span class="n">include_lowest</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">new_prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_prop</span><span class="si">}</span><span class="s2">_intervals&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">new_prop</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">target_property</span><span class="o">.</span><span class="n">originalName</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">th</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">target_property</span><span class="o">.</span><span class="n">task</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">TargetTasks</span><span class="o">.</span><span class="n">SINGLECLASS</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">TargetTasks</span><span class="o">.</span><span class="n">MULTICLASS</span>
            <span class="p">)</span>
            <span class="n">target_property</span><span class="o">.</span><span class="n">th</span> <span class="o">=</span> <span class="n">th</span>
            <span class="n">target_property</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">new_prop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restoreTrainingData</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Target property converted to classification.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">target_property</span></div>

<div class="viewcode-block" id="QSPRDataset.loadMetadata"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.loadMetadata">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">loadMetadata</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">store_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load metadata from a JSON file.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): name of the data set</span>
<span class="sd">            store_dir (str): directory where the data set is stored</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">store_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_meta.json&quot;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">meta</span><span class="p">[</span><span class="s2">&quot;init&quot;</span><span class="p">][</span><span class="s2">&quot;target_props&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TargetProperty</span><span class="o">.</span><span class="n">fromList</span><span class="p">(</span>
                <span class="n">meta</span><span class="p">[</span><span class="s2">&quot;init&quot;</span><span class="p">][</span><span class="s2">&quot;target_props&quot;</span><span class="p">],</span> <span class="n">task_from_str</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">meta</span></div>

<div class="viewcode-block" id="QSPRDataset.fromFile"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.fromFile">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fromFile</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;QSPRDataset&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load QSPRDataset from the saved file directly.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): path to the saved file</span>
<span class="sd">            args: additional arguments to pass to the constructor</span>
<span class="sd">            kwargs: additional keyword arguments to pass to the constructor</span>

<span class="sd">        Returns:</span>
<span class="sd">            QSPRDataset: loaded data set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">store_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">QSPRDataset</span><span class="o">.</span><span class="n">loadMetadata</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">store_dir</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">QSPRDataset</span><span class="p">(</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">store_dir</span><span class="o">=</span><span class="n">store_dir</span><span class="p">,</span> <span class="o">**</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;init&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="QSPRDataset.fromMolTable"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.fromMolTable">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fromMolTable</span><span class="p">(</span>
        <span class="n">mol_table</span><span class="p">:</span> <span class="n">MoleculeTable</span><span class="p">,</span>
        <span class="n">target_props</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">TargetProperty</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">],</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;QSPRDataset&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create QSPRDataset from a MoleculeTable.</span>

<span class="sd">        Args:</span>
<span class="sd">            mol_table (MoleculeTable): MoleculeTable to use as the data source</span>
<span class="sd">            target_props (list): list of target properties to use</span>
<span class="sd">            name (str, optional): name of the data set. Defaults to None.</span>
<span class="sd">            kwargs: additional keyword arguments to pass to the constructor</span>

<span class="sd">        Returns:</span>
<span class="sd">            QSPRDataset: created data set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;store_dir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">mol_table</span><span class="o">.</span><span class="n">storeDir</span> <span class="k">if</span> <span class="s2">&quot;store_dir&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;store_dir&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">mol_table</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">name</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">QSPRDataset</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">target_props</span><span class="p">,</span> <span class="n">mol_table</span><span class="o">.</span><span class="n">getDF</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">descriptorCalculators</span> <span class="o">=</span> <span class="n">mol_table</span><span class="o">.</span><span class="n">descriptorCalculators</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">descriptors</span> <span class="o">=</span> <span class="n">mol_table</span><span class="o">.</span><span class="n">descriptors</span>
        <span class="k">return</span> <span class="n">ds</span></div>

<div class="viewcode-block" id="QSPRDataset.addCustomDescriptors"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.addCustomDescriptors">[docs]</a>    <span class="k">def</span> <span class="nf">addCustomDescriptors</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">calculator</span><span class="p">:</span> <span class="s2">&quot;CustomDescriptorsCalculator&quot;</span><span class="p">,</span>  <span class="c1"># noqa: F821</span>
        <span class="n">recalculate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">featurize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add custom descriptors to the data set.</span>

<span class="sd">        If descriptors are already present, they will be recalculated if `recalculate`</span>
<span class="sd">        is `True`.</span>

<span class="sd">        Args:</span>
<span class="sd">            calculator (CustomDescriptorsCalculator): calculator instance to use for</span>
<span class="sd">                descriptor calculation</span>
<span class="sd">            recalculate (bool, optional): whether to recalculate descriptors if they</span>
<span class="sd">                are already present. Defaults to `False`.</span>
<span class="sd">            featurize (bool, optional): whether to featurize the data set splits</span>
<span class="sd">                after adding descriptors. Defaults to `True`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">addCustomDescriptors</span><span class="p">(</span><span class="n">calculator</span><span class="p">,</span> <span class="n">recalculate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featurize</span><span class="p">(</span><span class="n">update_splits</span><span class="o">=</span><span class="n">featurize</span><span class="p">)</span></div>

<div class="viewcode-block" id="QSPRDataset.addDescriptors"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.addDescriptors">[docs]</a>    <span class="k">def</span> <span class="nf">addDescriptors</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">calculator</span><span class="p">:</span> <span class="s2">&quot;MoleculeDescriptorsCalculator&quot;</span><span class="p">,</span>  <span class="c1"># noqa: F821</span>
        <span class="n">recalculate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">featurize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add descriptors to the data set.</span>

<span class="sd">        If descriptors are already present, they will be recalculated if `recalculate`</span>
<span class="sd">        is `True`. Featurization will be performed after adding descriptors if</span>
<span class="sd">        `featurize` is `True`. Featurazation converts current data matrices to pure</span>
<span class="sd">        numeric matrices of selected descriptors (features).</span>

<span class="sd">        Args:</span>
<span class="sd">            calculator (MoleculeDescriptorsCalculator): calculator instance to use for</span>
<span class="sd">                descriptor calculation</span>
<span class="sd">            recalculate (bool, optional): whether to recalculate descriptors if they are</span>
<span class="sd">                already present. Defaults to `False`.</span>
<span class="sd">            featurize (bool, optional): whether to featurize the data set splits after</span>
<span class="sd">                adding descriptors. Defaults to `True`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">addDescriptors</span><span class="p">(</span><span class="n">calculator</span><span class="p">,</span> <span class="n">recalculate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featurize</span><span class="p">(</span><span class="n">update_splits</span><span class="o">=</span><span class="n">featurize</span><span class="p">)</span></div>

<div class="viewcode-block" id="QSPRDataset.featurize"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.featurize">[docs]</a>    <span class="k">def</span> <span class="nf">featurize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_splits</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featureNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFeatureNames</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">update_splits</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">featurizeSplits</span><span class="p">()</span></div>

<div class="viewcode-block" id="QSPRDataset.saveSplit"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.saveSplit">[docs]</a>    <span class="k">def</span> <span class="nf">saveSplit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save split data to the managed data frame.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Split_IsTrain&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No split data available. Skipping split data save.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="QSPRDataset.save"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_split</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the data set to file and serialize metadata.</span>

<span class="sd">        Args:</span>
<span class="sd">            save_split (bool): whether to save split data to the managed data frame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">save_split</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveSplit</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="c1"># save metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveMetadata</span><span class="p">()</span></div>

<div class="viewcode-block" id="QSPRDataset.split"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.split">[docs]</a>    <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">split</span><span class="p">:</span> <span class="n">DataSplit</span><span class="p">,</span> <span class="n">featurize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Split dataset into train and test set.</span>

<span class="sd">        You can either split tha data frame itself or you can set `featurize` to `True`</span>
<span class="sd">        if you want to use feature matrices instead of the raw data frame.</span>

<span class="sd">        Args:</span>
<span class="sd">            split (DataSplit) :</span>
<span class="sd">                split instance orchestrating the split</span>
<span class="sd">            featurize (bool):</span>
<span class="sd">                whether to featurize the data set splits after splitting.</span>
<span class="sd">                Defaults to `False`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="n">split</span><span class="p">,</span> <span class="s2">&quot;hasDataSet&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">split</span><span class="p">,</span> <span class="s2">&quot;setDataSet&quot;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="ow">not</span> <span class="n">split</span><span class="o">.</span><span class="n">hasDataSet</span>
        <span class="p">):</span>
            <span class="n">split</span><span class="o">.</span><span class="n">setDataSet</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># split the data into train and test</span>
        <span class="n">folds</span> <span class="o">=</span> <span class="n">Folds</span><span class="p">(</span><span class="n">split</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_ind</span><span class="p">,</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
            <span class="n">folds</span><span class="o">.</span><span class="n">iterFolds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">targetPropertyNames</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_index</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_index</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_index</span><span class="p">,</span> <span class="p">:][</span><span class="bp">self</span><span class="o">.</span><span class="n">targetPropertyNames</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_index</span><span class="p">,</span> <span class="p">:][</span><span class="bp">self</span><span class="o">.</span><span class="n">targetPropertyNames</span><span class="p">]</span>
        <span class="c1"># select target properties</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Total: train: </span><span class="si">%s</span><span class="s2"> test: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_ind</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetProperties</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Target property: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prop</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">TargetTasks</span><span class="o">.</span><span class="n">SINGLECLASS</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;    In train: active: </span><span class="si">%s</span><span class="s2"> not active: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="p">]),</span>
                        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="p">])</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="p">]),</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;    In test:  active: </span><span class="si">%s</span><span class="s2"> not active: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_ind</span><span class="p">[</span><span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="p">]),</span>
                        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_ind</span><span class="p">[</span><span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="p">])</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_ind</span><span class="p">[</span><span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="p">]),</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">prop</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">TargetTasks</span><span class="o">.</span><span class="n">MULTICLASS</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;train: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;test: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_ind</span><span class="p">[</span><span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()])</span>
                    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_ind</span><span class="p">[</span><span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()])</span>
                <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                        <span class="s2">&quot;All bins in multi-class classification &quot;</span>
                        <span class="s2">&quot;should contain at least one sample&quot;</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="n">err</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">y_ind</span><span class="p">[</span><span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_ind</span><span class="p">[</span><span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>
        <span class="c1"># convert splits to features if required</span>
        <span class="k">if</span> <span class="n">featurize</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">featurizeSplits</span><span class="p">()</span></div>

<div class="viewcode-block" id="QSPRDataset.loadDataToSplits"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.loadDataToSplits">[docs]</a>    <span class="k">def</span> <span class="nf">loadDataToSplits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load the data frame into the train and test splits.</span>

<span class="sd">        Loads only if the information is available. Otherwise, the whole data</span>
<span class="sd">        set will be regarded as the training set and the test set will have zero length.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">targetPropertyNames</span><span class="p">]</span>

        <span class="c1"># split data into training and independent sets if saved previously</span>
        <span class="k">if</span> <span class="s2">&quot;Split_IsTrain&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Split_IsTrain&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;~Split_IsTrain&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">targetPropertyNames</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">targetPropertyNames</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="QSPRDataset.loadDescriptorsToSplits"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.loadDescriptorsToSplits">[docs]</a>    <span class="k">def</span> <span class="nf">loadDescriptorsToSplits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                <span class="n">shuffle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load all available descriptors into the train and test splits.</span>

<span class="sd">        If no descriptors are available, an exception will be raised.</span>

<span class="sd">        args:</span>
<span class="sd">            shuffle (bool): whether to shuffle the training and test sets</span>
<span class="sd">            random_state (int): random state for shuffling</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: if no descriptors are available</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasDescriptors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;No descriptors available. Cannot load descriptors to splits.&quot;</span>
            <span class="p">)</span>

        <span class="n">descriptors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDescriptors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">descriptors</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetPropertyNames</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span> <span class="o">=</span> <span class="n">descriptors</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y_ind</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetPropertyNames</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_ind</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">targetPropertyNames</span><span class="p">])</span>

        <span class="c1"># shuffle the training and test sets</span>
        <span class="k">if</span> <span class="n">shuffle</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_ind</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span></div>

<div class="viewcode-block" id="QSPRDataset.featurizeSplits"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.featurizeSplits">[docs]</a>    <span class="k">def</span> <span class="nf">featurizeSplits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shuffle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;If the data set has descriptors, load them into the train and test splits.</span>

<span class="sd">        If no descriptors are available, remove all features from</span>
<span class="sd">        the splits They will become zero length along the feature axis (columns), but</span>
<span class="sd">        will retain their original length along the sample axis (rows). This is useful</span>
<span class="sd">        for the case where the data set has no descriptors, but the user wants to retain</span>
<span class="sd">        train and test splits.</span>

<span class="sd">        shuffle (bool): whether to shuffle the training and test sets</span>
<span class="sd">        random_state (int): random state for shuffling</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureNames</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadDescriptorsToSplits</span><span class="p">(</span><span class="n">shuffle</span><span class="o">=</span><span class="n">shuffle</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">featureNames</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">featureNames</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="QSPRDataset.fillMissing"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.fillMissing">[docs]</a>    <span class="k">def</span> <span class="nf">fillMissing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fill_value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fill missing values in the data set with a given value.</span>

<span class="sd">        Args:</span>
<span class="sd">            fill_value (float): value to fill missing values with</span>
<span class="sd">            columns (list[str], optional): columns to fill missing values in.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">desc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="p">:</span>
            <span class="n">desc</span><span class="o">.</span><span class="n">fillMissing</span><span class="p">(</span><span class="n">fill_value</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Missing values filled with </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">fill_value</span><span class="p">)</span></div>

<div class="viewcode-block" id="QSPRDataset.filterFeatures"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.filterFeatures">[docs]</a>    <span class="k">def</span> <span class="nf">filterFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_filters</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Callable</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter features in the data set.</span>

<span class="sd">        Args:</span>
<span class="sd">            feature_filters (list[Callable]): list of feature filter functions that take</span>
<span class="sd">                X feature matrix and y target vector as arguments</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasFeatures</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No features to filter&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Only one feature present. Skipping feature filtering.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">featurefilter</span> <span class="ow">in</span> <span class="n">feature_filters</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">featurefilter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">featureNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">featureNames</span><span class="p">]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selected features: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">featureNames</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># update descriptor calculator</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptorCalculators</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">calc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptorCalculators</span><span class="p">:</span>
                    <span class="n">prefix</span> <span class="o">=</span> <span class="n">calc</span><span class="o">.</span><span class="n">getPrefix</span><span class="p">()</span>
                    <span class="n">calc</span><span class="o">.</span><span class="n">keepDescriptors</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureNames</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">)]</span>
                    <span class="p">)</span></div>

<div class="viewcode-block" id="QSPRDataset.setFeatureStandardizer"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.setFeatureStandardizer">[docs]</a>    <span class="k">def</span> <span class="nf">setFeatureStandardizer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_standardizer</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set feature standardizer.</span>

<span class="sd">        Args:</span>
<span class="sd">            feature_standardizer (SKLearnStandardizer | BaseEstimator): feature</span>
<span class="sd">                standardizer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">feature_standardizer</span><span class="p">,</span> <span class="s2">&quot;toFile&quot;</span><span class="p">):</span>
            <span class="n">feature_standardizer</span> <span class="o">=</span> <span class="n">SKLearnStandardizer</span><span class="p">(</span><span class="n">feature_standardizer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_standardizer</span> <span class="o">=</span> <span class="n">feature_standardizer</span></div>

<div class="viewcode-block" id="QSPRDataset.addFeatures"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.addFeatures">[docs]</a>    <span class="k">def</span> <span class="nf">addFeatures</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">feature_calculators</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="s2">&quot;DescriptorsCalculator&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># noqa: F821</span>
        <span class="n">recalculate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add features to the data set.</span>

<span class="sd">        Args:</span>
<span class="sd">            feature_calculators (List[DescriptorsCalculator], optional): list of</span>
<span class="sd">                feature calculators to add. Defaults to None.</span>
<span class="sd">            recalculate (bool): if True, recalculate features even if they are already</span>
<span class="sd">                present in the data set. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">feature_calculators</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">calc</span> <span class="ow">in</span> <span class="n">feature_calculators</span><span class="p">:</span>
                <span class="c1"># we avoid isinstance() here to avoid circular imports</span>
                <span class="k">if</span> <span class="n">calc</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;MoleculeDescriptorsCalculator&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addDescriptors</span><span class="p">(</span><span class="n">calc</span><span class="p">,</span> <span class="n">recalculate</span><span class="o">=</span><span class="n">recalculate</span><span class="p">,</span> <span class="n">featurize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown feature calculator type: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">calc</span><span class="p">))</span></div>

<div class="viewcode-block" id="QSPRDataset.prepareDataset"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.prepareDataset">[docs]</a>    <span class="k">def</span> <span class="nf">prepareDataset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">smiles_standardizer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Callable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;chembl&quot;</span><span class="p">,</span>
        <span class="n">datafilters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">split</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_calculators</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_filters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_standardizer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SKLearnStandardizer</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_fill_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
        <span class="n">recalculate_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">shuffle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepare the dataset for use in QSPR model.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            smiles_standardizer (str | Callable): either `chembl`, `old`, or a</span>
<span class="sd">                partial function that reads and standardizes smiles. If `None`, no</span>
<span class="sd">                standardization will be performed. Defaults to `chembl`.</span>
<span class="sd">            datafilters (list of datafilter obj): filters number of rows from dataset</span>
<span class="sd">            split (datasplitter obj): splits the dataset into train and test set</span>
<span class="sd">            fold (datasplitter obj): splits the train set into folds for</span>
<span class="sd">                cross validation</span>
<span class="sd">            feature_calculators (list[DescriptorsCalculator]): calculate features using</span>
<span class="sd">                different information from the data set</span>
<span class="sd">            feature_filters (list of feature filter objs): filters features</span>
<span class="sd">            feature_standardizer (SKLearnStandardizer or sklearn.base.BaseEstimator):</span>
<span class="sd">                standardizes and/or scales features</span>
<span class="sd">            recalculate_features (bool): recalculate features even if they are already</span>
<span class="sd">                present in the file</span>
<span class="sd">            feature_fill_value (float): value to fill missing values with.</span>
<span class="sd">                Defaults to `numpy.nan`</span>
<span class="sd">            shuffle (bool): whether to shuffle the training and test sets</span>
<span class="sd">            random_state (int): random state for shuffling</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># apply sanitization and standardization</span>
        <span class="k">if</span> <span class="n">smiles_standardizer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">standardizeSmiles</span><span class="p">(</span><span class="n">smiles_standardizer</span><span class="p">)</span>

        <span class="c1"># calculate features</span>
        <span class="k">if</span> <span class="n">feature_calculators</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addFeatures</span><span class="p">(</span><span class="n">feature_calculators</span><span class="p">,</span> <span class="n">recalculate</span><span class="o">=</span><span class="n">recalculate_features</span><span class="p">)</span>

        <span class="c1"># apply data filters</span>
        <span class="k">if</span> <span class="n">datafilters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">datafilters</span><span class="p">)</span>

        <span class="c1"># Replace any NaN values in featureNames by 0</span>
        <span class="c1"># FIXME: this is not very good, we should probably add option to do custom</span>
        <span class="c1"># data imputation here or drop rows with NaNs</span>
        <span class="k">if</span> <span class="n">feature_fill_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fillMissing</span><span class="p">(</span><span class="n">feature_fill_value</span><span class="p">)</span>

        <span class="c1"># split dataset</span>
        <span class="k">if</span> <span class="n">split</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">targetPropertyNames</span><span class="p">]</span>

        <span class="c1"># featurize splits</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasDescriptors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">featurizeSplits</span><span class="p">(</span><span class="n">shuffle</span><span class="o">=</span><span class="n">shuffle</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Attempting to featurize splits without descriptors. &quot;</span>
                <span class="s2">&quot;Skipping this step...&quot;</span>
            <span class="p">)</span>

        <span class="c1"># apply feature filters on training set</span>
        <span class="k">if</span> <span class="n">feature_filters</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasDescriptors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filterFeatures</span><span class="p">(</span><span class="n">feature_filters</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasDescriptors</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No descriptors present, feature filters will be skipped.&quot;</span><span class="p">)</span>

        <span class="c1"># set feature standardizers</span>
        <span class="k">if</span> <span class="n">feature_standardizer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setFeatureStandardizer</span><span class="p">(</span><span class="n">feature_standardizer</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fold_generator</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fold_generator</span> <span class="o">=</span> <span class="n">Folds</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fold_generator</span><span class="o">.</span><span class="n">split</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_standardizer</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasDescriptors</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;No descriptors present, feature standardizers were initialized, &quot;</span>
                    <span class="s2">&quot;but might fail or have no effect.&quot;</span>
                <span class="p">)</span>

        <span class="c1"># create fold generator</span>
        <span class="k">if</span> <span class="n">fold</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fold_generator</span> <span class="o">=</span> <span class="n">Folds</span><span class="p">(</span><span class="n">fold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_standardizer</span><span class="p">)</span></div>

<div class="viewcode-block" id="QSPRDataset.getDefaultFoldSplit"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.getDefaultFoldSplit">[docs]</a>    <span class="k">def</span> <span class="nf">getDefaultFoldSplit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the default fold split for the model task.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataSplit (DataSplit): default fold split implementation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targetProperties</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">targetProperties</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">TargetTasks</span><span class="o">.</span><span class="n">REGRESSION</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">KFold</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span></div>

<div class="viewcode-block" id="QSPRDataset.getDefaultFoldGenerator"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.getDefaultFoldGenerator">[docs]</a>    <span class="k">def</span> <span class="nf">getDefaultFoldGenerator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the default fold generator. The fold generator is used to create folds</span>
<span class="sd">        for cross validation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Folds (Folds): default fold generator implementation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Folds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDefaultFoldSplit</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_standardizer</span><span class="p">)</span></div>

<div class="viewcode-block" id="QSPRDataset.checkFeatures"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.checkFeatures">[docs]</a>    <span class="k">def</span> <span class="nf">checkFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check consistency of features and descriptors.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasDescriptors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;No descriptors exist in the data set. Cannot create folds.&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasFeatures</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No features exist in the data set. Cannot create folds.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;X and y have different number of rows: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;X has no rows.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="QSPRDataset.createFolds"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.createFolds">[docs]</a>    <span class="k">def</span> <span class="nf">createFolds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">split</span><span class="p">:</span> <span class="n">DataSplit</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create folds for cross validation from the  current feature matrix.</span>

<span class="sd">        If you specify a split to use, it will be used to generate the folds.</span>
<span class="sd">        The split should implement the `DataSplit` interface. It can</span>
<span class="sd">        also optionally implement `DataSetDependant` if the split requires the full</span>
<span class="sd">        data set besides the feature matrix alone.</span>

<span class="sd">        Args:</span>
<span class="sd">            split (DataSplit, optional): split to use for creating folds.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># do some checks and give split tha data set if required</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkFeatures</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">split</span><span class="p">,</span> <span class="s1">&#39;setDataSet&#39;</span><span class="p">):</span>
            <span class="n">split</span><span class="o">.</span><span class="n">setDataSet</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># choose the fold generator</span>
        <span class="k">if</span> <span class="n">split</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fold_generator</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fold_generator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDefaultFoldGenerator</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">split</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fold_generator</span> <span class="o">=</span> <span class="n">Folds</span><span class="p">(</span><span class="n">split</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_standardizer</span><span class="p">)</span>
        <span class="c1"># generate the folds</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fold_generator</span><span class="o">.</span><span class="n">iterFolds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span></div>

<div class="viewcode-block" id="QSPRDataset.fitFeatureStandardizer"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.fitFeatureStandardizer">[docs]</a>    <span class="k">def</span> <span class="nf">fitFeatureStandardizer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit the feature standardizers on the training set.</span>

<span class="sd">        Returns:</span>
<span class="sd">            X (pd.DataFrame): standardized training set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasDescriptors</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDescriptors</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureNames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">featureNames</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">apply_feature_standardizer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_standardizer</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="QSPRDataset.getFeatures"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.getFeatures">[docs]</a>    <span class="k">def</span> <span class="nf">getFeatures</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">concat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the current feature sets (training and test) from the dataset.</span>

<span class="sd">        This method also applies any feature standardizers that have been set on the</span>
<span class="sd">        dataset during preparation.</span>

<span class="sd">        Args:</span>
<span class="sd">            inplace (bool): If `True`, the created feature matrices will be saved to the</span>
<span class="sd">                dataset object itself as &#39;X&#39; and &#39;X_ind&#39; attributes. Note that this will</span>
<span class="sd">                overwrite any existing feature matrices and if the data preparation</span>
<span class="sd">                workflow changes, these are not kept up to date. Therefore, it is</span>
<span class="sd">                recommended to generate new feature sets after any data set changes.</span>
<span class="sd">            concat (bool): If `True`, the training and test feature matrices will be</span>
<span class="sd">                concatenated into a single matrix. This is useful for training models</span>
<span class="sd">                that do not require separate training and test sets (i.e. the final</span>
<span class="sd">                optimized models).</span>
<span class="sd">            raw (bool): If `True`, the raw feature matrices will be returned without</span>
<span class="sd">                any standardization applied.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkFeatures</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">concat</span><span class="p">:</span>
            <span class="n">df_X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">featureNames</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">featureNames</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>
            <span class="n">df_X_ind</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">featureNames</span><span class="p">]</span>
            <span class="n">df_X_ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">featureNames</span><span class="p">]</span>

        <span class="n">X</span> <span class="o">=</span> <span class="n">df_X</span><span class="o">.</span><span class="n">values</span>
        <span class="n">X_ind</span> <span class="o">=</span> <span class="n">df_X_ind</span><span class="o">.</span><span class="n">values</span> <span class="k">if</span> <span class="n">df_X_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">raw</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_standardizer</span><span class="p">:</span>
            <span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_standardizer</span> <span class="o">=</span> <span class="n">apply_feature_standardizer</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">feature_standardizer</span><span class="p">,</span> <span class="n">df_X</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">X_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">X_ind</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">X_ind</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">apply_feature_standardizer</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">feature_standardizer</span><span class="p">,</span> <span class="n">df_X_ind</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>

        <span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df_X</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">df_X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">X_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">X_ind</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_ind</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df_X_ind</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">df_X_ind</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X_ind</span> <span class="o">=</span> <span class="n">X_ind</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X_ind</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">concat</span> <span class="k">else</span> <span class="n">X</span></div>

<div class="viewcode-block" id="QSPRDataset.getTargetPropertiesValues"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.getTargetPropertiesValues">[docs]</a>    <span class="k">def</span> <span class="nf">getTargetPropertiesValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">concat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the response values (training and test) for the set target property.</span>

<span class="sd">        Args:</span>
<span class="sd">            concat (bool): if `True`, return concatenated training and validation set</span>
<span class="sd">                target properties</span>

<span class="sd">        Returns:</span>
<span class="sd">            `tuple` of (train_responses, test_responses) or `pandas.DataFrame` of all</span>
<span class="sd">            target property values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">concat</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_ind</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_ind</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span></div>

<div class="viewcode-block" id="QSPRDataset.getTargetProperties"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.getTargetProperties">[docs]</a>    <span class="k">def</span> <span class="nf">getTargetProperties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">original_names</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the target properties with the given names.</span>

<span class="sd">        Args:</span>
<span class="sd">            names (list[str]): name of the target properties</span>
<span class="sd">            original_names (bool): if `True`, use the original names of the target</span>
<span class="sd">                properties</span>

<span class="sd">        Returns:</span>
<span class="sd">            `TargetProperty`: target property with the given name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">TargetProperty</span><span class="o">.</span><span class="n">selectFromList</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">targetProperties</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">original_names</span><span class="o">=</span><span class="n">original_names</span>
        <span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">targetPropertyNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the names of the target properties.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">TargetProperty</span><span class="o">.</span><span class="n">getNames</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targetProperties</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">targetPropertyOriginalNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the original names of the target properties.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">TargetProperty</span><span class="o">.</span><span class="n">getOriginalNames</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targetProperties</span><span class="p">)</span>

<div class="viewcode-block" id="QSPRDataset.loadFeatureStandardizer"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.loadFeatureStandardizer">[docs]</a>    <span class="k">def</span> <span class="nf">loadFeatureStandardizer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load feature standardizer from the metadata.</span>

<span class="sd">        Returns:</span>
<span class="sd">            `SKLearnStandardizer`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;standardizer_path&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">[</span><span class="s2">&quot;standardizer_path&quot;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">SKLearnStandardizer</span><span class="o">.</span><span class="n">fromFile</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storePrefix</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">[</span><span class="s1">&#39;standardizer_path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="QSPRDataset.saveFeatureStandardizer"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.saveFeatureStandardizer">[docs]</a>    <span class="k">def</span> <span class="nf">saveFeatureStandardizer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save feature standardizers to the metadata.</span>

<span class="sd">        Returns:</span>
<span class="sd">            `str`: paths to the saved standardizers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storePrefix</span><span class="si">}</span><span class="s2">_feature_standardizer.json&quot;</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feature_standardizer</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureNames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featureNames</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="c1"># make sure feature standardizers are fitted before serialization</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fitFeatureStandardizer</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feature_standardizer</span><span class="o">.</span><span class="n">toFile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">path</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_standardizer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feature_standardizer</span><span class="o">.</span><span class="n">toFile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">path</span></div>

<div class="viewcode-block" id="QSPRDataset.saveMetadata"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.saveMetadata">[docs]</a>    <span class="k">def</span> <span class="nf">saveMetadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save metadata to file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            `str`: path to the saved metadata file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveFeatureStandardizer</span><span class="p">()</span>

        <span class="n">meta_init</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;target_props&quot;</span><span class="p">:</span>
                <span class="n">TargetProperty</span><span class="o">.</span><span class="n">toList</span><span class="p">(</span>
                    <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targetProperties</span><span class="p">),</span> <span class="n">task_as_str</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">),</span>
            <span class="s2">&quot;smiles_col&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">smilesCol</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;init&quot;</span><span class="p">:</span>
                <span class="n">meta_init</span><span class="p">,</span>
            <span class="s2">&quot;standardizer_path&quot;</span><span class="p">:</span>
                <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storePrefix</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">path</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;descriptorcalculator_path&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">descriptorCalculatorsPathPrefix</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storePrefix</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptorCalculatorsPathPrefix</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;feature_names&quot;</span><span class="p">:</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featureNames</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureNames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storePrefix</span><span class="si">}</span><span class="s2">_meta.json&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">path</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">isMultiTask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the dataset contains multiple target properties.</span>

<span class="sd">        Returns:</span>
<span class="sd">            `bool`: `True` if the dataset contains multiple target properties</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targetProperties</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nTasks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the number of target properties in the dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targetProperties</span><span class="p">)</span>

<div class="viewcode-block" id="QSPRDataset.dropTask"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.dropTask">[docs]</a>    <span class="k">def</span> <span class="nf">dropTask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Drop the given task from the dataset.</span>

<span class="sd">        Args:</span>
<span class="sd">            task (str): name of the task to drop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetPropertyNames</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Task </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2"> not found in dataset.&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targetProperties</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="p">),</span> <span class="s2">&quot;Cannot drop task from single-task dataset.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targetProperties</span> <span class="o">=</span> <span class="p">[</span><span class="n">tp</span> <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetProperties</span> <span class="k">if</span> <span class="n">tp</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">task</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restoreTrainingData</span><span class="p">()</span></div>

<div class="viewcode-block" id="QSPRDataset.addTask"><a class="viewcode-back" href="../../../api/qsprpred.data.html#qsprpred.data.data.QSPRDataset.addTask">[docs]</a>    <span class="k">def</span> <span class="nf">addTask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">TargetProperty</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a task to the dataset.</span>

<span class="sd">        Args:</span>
<span class="sd">            task (TargetProperty): name of the task to add</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">task</span> <span class="o">=</span> <span class="n">TargetProperty</span><span class="o">.</span><span class="n">fromDict</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">task</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetPropertyNames</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Task </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2"> already exists in dataset.&quot;</span>
        <span class="k">assert</span> <span class="n">task</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Task </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2"> not found in dataset.&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">targetProperties</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restoreTrainingData</span><span class="p">()</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>