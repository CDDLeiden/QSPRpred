<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>qsprpred.models.interfaces &mdash; QSPRpred 1.3.1 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            QSPRpred
          </a>
              <div class="version">
                v1.3.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome to QSPRpredâ€™s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../use.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../use.html#cli-example">CLI Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/modules.html">Python API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">QSPRpred</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">qsprpred.models.interfaces</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for qsprpred.models.interfaces</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;This module holds the base class for QSPRmodels, model types should be a subclass.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">isclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">qsprpred</span> <span class="kn">import</span> <span class="n">VERSION</span>
<span class="kn">from</span> <span class="nn">qsprpred.data.data</span> <span class="kn">import</span> <span class="n">MoleculeTable</span><span class="p">,</span> <span class="n">QSPRDataset</span>
<span class="kn">from</span> <span class="nn">qsprpred.data.utils.descriptorcalculator</span> <span class="kn">import</span> <span class="n">DescriptorsCalculator</span>
<span class="kn">from</span> <span class="nn">qsprpred.data.utils.feature_standardization</span> <span class="kn">import</span> <span class="n">SKLearnStandardizer</span>
<span class="kn">from</span> <span class="nn">qsprpred.logs</span> <span class="kn">import</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">qsprpred.models</span> <span class="kn">import</span> <span class="n">SSPACE</span>
<span class="kn">from</span> <span class="nn">qsprpred.models.tasks</span> <span class="kn">import</span> <span class="n">ModelTasks</span>
<span class="kn">from</span> <span class="nn">qsprpred.utils.inspect</span> <span class="kn">import</span> <span class="n">import_class</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>


<div class="viewcode-block" id="QSPRModel"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel">[docs]</a><span class="k">class</span> <span class="nc">QSPRModel</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The definition of the common model interface for the package. Handles model initialization, fit, cross validation and hyperparameter optimization.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        name (str): name of the model</span>
<span class="sd">        data (QSPRDataset): data set used to train the model</span>
<span class="sd">        alg (estimator): estimator instance or class</span>
<span class="sd">        parameters (dict): dictionary of algorithm specific parameters</span>
<span class="sd">        model (estimator): the underlying estimator instance, if `fit` or optimization is perforemed, this model instance gets updated accordingly</span>
<span class="sd">        featureCalculator (DescriptorsCalculator): feature calculator instance taken from the data set or deserialized from file if the model is loaded without data</span>
<span class="sd">        featureStandardizer (SKLearnStandardizer): feature standardizer instance taken from the data set or deserialized from file if the model is loaded without data</span>
<span class="sd">        metaInfo (dict): dictionary of metadata about the model, only available after the model is saved</span>
<span class="sd">        baseDir (str): base directory of the model, the model files are stored in a subdirectory `{baseDir}/{outDir}/`</span>
<span class="sd">        outDir (str): output directory of the model, the model files are stored in this directory (`{baseDir}/qspr/models/{name}`)</span>
<span class="sd">        outPrefix (str): output prefix of the model files, the model files are stored with this prefix (i.e. `{outPrefix}_meta.json`)</span>
<span class="sd">        metaFile (str): absolute path to the metadata file of the model (`{outPrefix}_meta.json`)</span>
<span class="sd">        task (ModelTasks): task of the model, taken from the data set or deserialized from file if the model is loaded without data</span>
<span class="sd">        targetProperty (str): target property of the model, taken from the data set or deserialized from file if the model is loaded without data</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_dir</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">alg</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data</span> <span class="p">:</span> <span class="n">QSPRDataset</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parameters</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">autoload</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a QSPR model instance. If the model is loaded from file, the data set is not required. Note that the data set is required for fitting and optimization.</span>

<span class="sd">        Args:</span>
<span class="sd">            base_dir (str): base directory of the model, the model files are stored in a subdirectory `{baseDir}/{outDir}/`</span>
<span class="sd">            alg (estimator): estimator instance or class</span>
<span class="sd">            data (QSPRDataset): data set used to train the model</span>
<span class="sd">            name (str): name of the model</span>
<span class="sd">            parameters (dict): dictionary of algorithm specific parameters</span>
<span class="sd">            autoload (bool): if True, the model is loaded from the serialized file if it exists, otherwise a new model is created</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="n">alg</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseDir</span> <span class="o">=</span> <span class="n">base_dir</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

        <span class="c1"># load metadata and update parameters accordingly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaFile</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">outPrefix</span><span class="si">}</span><span class="s2">_meta.json&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readMetadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metaFile</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metadata file &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metaFile</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># get parameters from metadata if available</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readParams</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseDir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">[</span><span class="s1">&#39;parameters_path&#39;</span><span class="p">]))</span>

        <span class="c1"># initialize a feature calculator instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featureCalculator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">descriptorCalculator</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">readDescriptorCalculator</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseDir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">[</span><span class="s1">&#39;feature_calculator_path&#39;</span><span class="p">]))</span>

        <span class="c1"># initialize a standardizer instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featureStandardizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">feature_standardizer</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">readStandardizer</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseDir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">[</span><span class="s1">&#39;feature_standardizer_path&#39;</span><span class="p">]))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">[</span><span class="s1">&#39;feature_standardizer_path&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="c1"># initialize a model instance with the given parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">alg</span>
        <span class="k">if</span> <span class="n">autoload</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadModel</span><span class="p">(</span><span class="n">alg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the name of the model and the underlying class as the identifier.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;None&#39;</span><span class="si">}</span><span class="s2">)&quot;</span>
    
    <span class="c1"># Adding scoring functions available for hyperparam optimization:</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_needs_proba_to_score</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">ModelTasks</span><span class="o">.</span><span class="n">CLASSIFICATION</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;average_precision&#39;</span><span class="p">,</span> <span class="s1">&#39;neg_brier_score&#39;</span><span class="p">,</span> <span class="s1">&#39;neg_log_loss&#39;</span><span class="p">,</span> <span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;roc_auc_ovo&#39;</span><span class="p">,</span> <span class="s1">&#39;roc_auc_ovo_weighted&#39;</span><span class="p">,</span> <span class="s1">&#39;roc_auc_ovr&#39;</span><span class="p">,</span> <span class="s1">&#39;roc_auc_ovr_weighted&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">ModelTasks</span><span class="o">.</span><span class="n">REGRESSION</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_needs_discrete_to_score</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">ModelTasks</span><span class="o">.</span><span class="n">CLASSIFICATION</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span><span class="s1">&#39;balanced_accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;top_k_accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="s1">&#39;f1_micro&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;f1_macro&#39;</span><span class="p">,</span> <span class="s1">&#39;f1_weighted&#39;</span><span class="p">,</span> <span class="s1">&#39;f1_samples&#39;</span><span class="p">,</span> <span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="s1">&#39;precision_micro&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;precision_macro&#39;</span><span class="p">,</span> <span class="s1">&#39;precision_weighted&#39;</span><span class="p">,</span> <span class="s1">&#39;precision_samples&#39;</span><span class="p">,</span> <span class="s1">&#39;recall&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;recall_micro&#39;</span><span class="p">,</span> <span class="s1">&#39;recall_macro&#39;</span><span class="p">,</span> <span class="s1">&#39;recall_weighted&#39;</span><span class="p">,</span> <span class="s1">&#39;recall_samples&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">ModelTasks</span><span class="o">.</span><span class="n">REGRESSION</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_supported_scoring</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">ModelTasks</span><span class="o">.</span><span class="n">CLASSIFICATION</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;average_precision&#39;</span><span class="p">,</span> <span class="s1">&#39;neg_brier_score&#39;</span><span class="p">,</span> <span class="s1">&#39;neg_log_loss&#39;</span><span class="p">,</span> <span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;roc_auc_ovo&#39;</span><span class="p">,</span> <span class="s1">&#39;roc_auc_ovo_weighted&#39;</span><span class="p">,</span> <span class="s1">&#39;roc_auc_ovr&#39;</span><span class="p">,</span> <span class="s1">&#39;roc_auc_ovr_weighted&#39;</span>
                    <span class="s1">&#39;accuracy&#39;</span><span class="p">,</span><span class="s1">&#39;balanced_accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;top_k_accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="s1">&#39;f1_micro&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;f1_macro&#39;</span><span class="p">,</span> <span class="s1">&#39;f1_weighted&#39;</span><span class="p">,</span> <span class="s1">&#39;f1_samples&#39;</span><span class="p">,</span> <span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="s1">&#39;precision_micro&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;precision_macro&#39;</span><span class="p">,</span> <span class="s1">&#39;precision_weighted&#39;</span><span class="p">,</span> <span class="s1">&#39;precision_samples&#39;</span><span class="p">,</span> <span class="s1">&#39;recall&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;recall_micro&#39;</span><span class="p">,</span> <span class="s1">&#39;recall_macro&#39;</span><span class="p">,</span> <span class="s1">&#39;recall_weighted&#39;</span><span class="p">,</span> <span class="s1">&#39;recall_samples&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">ModelTasks</span><span class="o">.</span><span class="n">REGRESSION</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;explained_variance&#39;</span><span class="p">,</span> <span class="s1">&#39;max_error&#39;</span><span class="p">,</span> <span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> <span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;neg_root_mean_squared_error&#39;</span><span class="p">,</span> <span class="s1">&#39;neg_mean_squared_log_error&#39;</span><span class="p">,</span> <span class="s1">&#39;neg_median_absolute_error&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="s1">&#39;neg_mean_poisson_deviance&#39;</span><span class="p">,</span> <span class="s1">&#39;neg_mean_gamma_deviance&#39;</span><span class="p">,</span> <span class="s1">&#39;neg_mean_absolute_percentage_error&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;d2_absolute_error_score&#39;</span><span class="p">,</span> <span class="s1">&#39;d2_pinball_score&#39;</span><span class="p">,</span> <span class="s1">&#39;d2_tweedie_scor&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">task</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The task of the model, taken from the data set or deserialized from file if the model is loaded without data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ModelTasks: task of the model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">task</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">[</span><span class="s1">&#39;task&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nClasses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The number of classes of the model, taken from the data set or deserialized from file if the model is loaded without data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: number of classes of the model if the task is classification, otherwise 0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">nClasses</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">[</span><span class="s1">&#39;nClasses&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">classPath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">targetProperty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The target property of the model, taken from the data set or deserialized from file if the model is loaded without data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: target property of the model</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">targetProperty</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">[</span><span class="s1">&#39;target_property&#39;</span><span class="p">]</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">outDir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The output directory of the model, the model files are stored in this directory (`{baseDir}/qspr/models/{name}`).</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: output directory of the model</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">baseDir</span><span class="si">}</span><span class="s1">/qspr/models/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">baseDir</span><span class="si">}</span><span class="s1">/qspr/models/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">outPrefix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The output prefix of the model files, the model files are stored with this prefix (i.e. `{outPrefix}_meta.json`).</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: output prefix of the model files</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">outDir</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span>

<div class="viewcode-block" id="QSPRModel.readParams"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel.readParams">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">readParams</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read model parameters from a JSON file.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): absolute path to the JSON file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">j</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;loading model parameters from file: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">read</span><span class="p">())</span></div>

<div class="viewcode-block" id="QSPRModel.saveParams"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel.saveParams">[docs]</a>    <span class="k">def</span> <span class="nf">saveParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save model parameters to a JSON file.</span>

<span class="sd">        Args:</span>
<span class="sd">            params (dict): dictionary of model parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">outDir</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_params.json&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">j</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;saving model parameters to file: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
            <span class="n">j</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">path</span></div>

<div class="viewcode-block" id="QSPRModel.readDescriptorCalculator"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel.readDescriptorCalculator">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">readDescriptorCalculator</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a descriptor calculator from a JSON file.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): absolute path to the JSON file</span>

<span class="sd">        Returns:</span>
<span class="sd">            DescriptorsCalculator: descriptor calculator instance or None if the file does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">DescriptorsCalculator</span><span class="o">.</span><span class="n">fromFile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="QSPRModel.saveDescriptorCalculator"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel.saveDescriptorCalculator">[docs]</a>    <span class="k">def</span> <span class="nf">saveDescriptorCalculator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the current descriptor calculator to a JSON file. The file is stored in the output directory of the model.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: absolute path to the JSON file containing the descriptor calculator</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">outDir</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_descriptor_calculator.json&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featureCalculator</span><span class="o">.</span><span class="n">toFile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span></div>

<div class="viewcode-block" id="QSPRModel.readStandardizer"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel.readStandardizer">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">readStandardizer</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a feature standardizer from a JSON file. If the file does not exist, None is returned.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): absolute path to the JSON file</span>

<span class="sd">        Returns:</span>
<span class="sd">            SKLearnStandardizer: feature standardizer instance or None if the file does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">SKLearnStandardizer</span><span class="o">.</span><span class="n">fromFile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="QSPRModel.saveStandardizer"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel.saveStandardizer">[docs]</a>    <span class="k">def</span> <span class="nf">saveStandardizer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the current feature standardizer to a JSON file. The file is stored in the output directory of the model.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: absolute path to the JSON file containing the saved feature standardizer</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">outDir</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_feature_standardizer.json&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featureStandardizer</span><span class="o">.</span><span class="n">toFile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span></div>

<div class="viewcode-block" id="QSPRModel.readMetadata"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel.readMetadata">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">readMetadata</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read model metadata from a JSON file.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): absolute path to the JSON file</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: dictionary containing the model metadata</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileNotFoundError: if the file does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">metaInfo</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                <span class="n">metaInfo</span><span class="p">[</span><span class="s1">&#39;task&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ModelTasks</span><span class="p">(</span><span class="n">metaInfo</span><span class="p">[</span><span class="s1">&#39;task&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Metadata file &quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">&quot; does not exist.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">metaInfo</span></div>

<div class="viewcode-block" id="QSPRModel.saveMetadata"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel.saveMetadata">[docs]</a>    <span class="k">def</span> <span class="nf">saveMetadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save model metadata to a JSON file. The file is stored in the output directory of the model.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: absolute path to the JSON file containing the model metadata</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metaFile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">j</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;saving model metadata to file: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaFile</span><span class="p">)</span>
            <span class="n">j</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaFile</span></div>

<div class="viewcode-block" id="QSPRModel.save"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the model data, parameters, metadata and all other files to the output directory of the model.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: dictionary containing the model metadata that was saved</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VERSION</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">[</span><span class="s1">&#39;model_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classPath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">[</span><span class="s1">&#39;task&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">[</span><span class="s1">&#39;th&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">th</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">[</span><span class="s1">&#39;th&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">[</span><span class="s1">&#39;nClasses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nClasses</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">[</span><span class="s1">&#39;target_property&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetProperty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">[</span><span class="s1">&#39;parameters_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveParams</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">baseDir</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">[</span><span class="s1">&#39;feature_calculator_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveDescriptorCalculator</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">baseDir</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureCalculator</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">[</span><span class="s1">&#39;feature_standardizer_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveStandardizer</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">baseDir</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureStandardizer</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaInfo</span><span class="p">[</span><span class="s1">&#39;model_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveModel</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">baseDir</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveMetadata</span><span class="p">()</span></div>

<div class="viewcode-block" id="QSPRModel.checkForData"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel.checkForData">[docs]</a>    <span class="k">def</span> <span class="nf">checkForData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the model has data set.</span>

<span class="sd">        Args:</span>
<span class="sd">            exception (bool): if true, an exception is raised if no data is set</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if data is set, False otherwise (if exception is False)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">hasData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">exception</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hasData</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No data set specified. Make sure you initialized this model with a &quot;QSPRDataset&quot; instance to train on.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">hasData</span></div>

<div class="viewcode-block" id="QSPRModel.fit"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel.fit">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build estimator model from the whole associated data set.&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="QSPRModel.evaluate"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel.evaluate">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make predictions for crossvalidation and independent test set. If save is True, the predictions are saved to a file</span>
<span class="sd">        in the output directory.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            save (bool): don&#39;t save predictions when used in bayesian optimization</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="QSPRModel.gridSearch"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel.gridSearch">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">gridSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_space_gs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Optimization of hyperparameters using gridSearch.</span>

<span class="sd">        Args:</span>
<span class="sd">            search_space_gs (dict): search space for the grid search</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="QSPRModel.bayesOptimization"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel.bayesOptimization">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">bayesOptimization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_space_gs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Bayesian optimization of hyperparameters using optuna.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            search_space_gs (dict): search space for the grid search</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="QSPRModel.loadParamsGrid"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel.loadParamsGrid">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">loadParamsGrid</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">optim_type</span><span class="p">,</span> <span class="n">model_types</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load parameter grids for bayes or grid search parameter optimization from json file.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            fname (str): file name of json file containing array with three columns containing modeltype,</span>
<span class="sd">                            optimization type (grid or bayes) and model type</span>
<span class="sd">            optim_type (str): optimization type (&#39;grid&#39; or &#39;bayes&#39;)</span>
<span class="sd">            model_types (list of str): model type for hyperparameter optimization (e.g. RF)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fname</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
                    <span class="n">optim_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Search space file (</span><span class="si">%s</span><span class="s2">) not found&quot;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">SSPACE</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
                <span class="n">optim_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>

        <span class="c1"># select either grid or bayes optimization parameters from param array</span>
        <span class="n">optim_params</span> <span class="o">=</span> <span class="n">optim_params</span><span class="p">[</span><span class="n">optim_params</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">optim_type</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c1"># check all modeltypes to be used have parameter grid</span>
        <span class="n">model_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_types</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">model_types</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">model_types</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">model_types</span><span class="p">))</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">optim_params</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;model types </span><span class="si">%s</span><span class="s2"> missing from models in search space dict (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">model_types</span><span class="p">,</span> <span class="n">optim_params</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;search space loaded from file&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">optim_params</span></div>

<div class="viewcode-block" id="QSPRModel.loadModel"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel.loadModel">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">loadModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alg</span> <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">params</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Initialize model instance with the given parameters. If no algorithm is given, the model is loaded from file based on available metadata. If no parameters are given, they are also loaded from the available file.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            alg (object): algorithm class to instantiate</span>
<span class="sd">            params (dict): algorithm parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="QSPRModel.saveModel"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel.saveModel">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">saveModel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the underlying model to file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: path to the saved model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="QSPRModel.predict"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel.predict">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span> <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">QSPRDataset</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make predictions for the given data matrix or `QSPRDataset`.</span>

<span class="sd">        Args:</span>
<span class="sd">            X (pd.DataFrame, np.ndarray, QSPRDataset): data matrix to make predictions for</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: an array of predictions, can be a 1D array for single target models or a 2D/3D array for multi-target/multi-class models</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="QSPRModel.predictProba"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel.predictProba">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">predictProba</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span> <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">QSPRDataset</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make predictions for the given data matrix or `QSPRDataset`, but use probabilities for classification models.</span>

<span class="sd">        Args:</span>
<span class="sd">            X (pd.DataFrame, np.ndarray, QSPRDataset): data matrix to make predictions for</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="QSPRModel.predictMols"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel.predictMols">[docs]</a>    <span class="k">def</span> <span class="nf">predictMols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">use_probas</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="n">smiles_standardizer</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">callable</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;chembl&#39;</span><span class="p">,</span>
                    <span class="n">n_jobs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fill_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make predictions for the given molecules.</span>

<span class="sd">        Args:</span>
<span class="sd">            mols (List[str]): list of SMILES strings</span>
<span class="sd">            use_probas (bool): use probabilities for classification models</span>
<span class="sd">            smiles_standardizer: either `chembl`, `old`, or a partial function that reads and standardizes smiles.</span>
<span class="sd">            n_jobs: Number of jobs to use for parallel processing.</span>
<span class="sd">            fill_value: Value to use for missing values in the feature matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dataset</span> <span class="o">=</span> <span class="n">MoleculeTable</span><span class="o">.</span><span class="n">fromSMILES</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mols</span><span class="p">,</span> <span class="n">drop_invalids</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                           <span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">)</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targetProperty</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">QSPRDataset</span><span class="o">.</span><span class="n">fromMolTable</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetProperty</span><span class="p">,</span> <span class="n">drop_empty</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">drop_invalids</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                           <span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">)</span>
        <span class="n">failed_mask</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">dropInvalids</span><span class="p">()</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="n">failed_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">failed_mask</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureCalculator</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No feature calculator set on this instance.&quot;</span><span class="p">)</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">prepareDataset</span><span class="p">(</span>
            <span class="n">smiles_standardizer</span><span class="o">=</span><span class="n">smiles_standardizer</span><span class="p">,</span>
            <span class="n">feature_calculator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">featureCalculator</span><span class="p">,</span>
            <span class="n">feature_standardizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">featureStandardizer</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="n">fill_value</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">ModelTasks</span><span class="o">.</span><span class="n">REGRESSION</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">use_probas</span><span class="p">:</span>
            <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">isclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;PLSRegression&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;PLSRegression&#39;</span><span class="p">):</span>
                <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">ModelTasks</span><span class="o">.</span><span class="n">CLASSIFICATION</span><span class="p">:</span>
                <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictProba</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">failed_indices</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">predictions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">pred</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mols</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">failed_indices</span><span class="p">:</span>
                    <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="n">dim</span> <span class="k">if</span> <span class="n">dim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">predictions</span></div>

<div class="viewcode-block" id="QSPRModel.fromFile"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel.fromFile">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">fromFile</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load a model from its meta file.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): full path to the model meta file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">meta</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">readMetadata</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">model_class</span> <span class="o">=</span> <span class="n">import_class</span><span class="p">(</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;model_class&quot;</span><span class="p">])</span>
        <span class="n">model_name</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;qspr/models/</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model_class</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">)</span></div>

<div class="viewcode-block" id="QSPRModel.cleanFiles"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel.cleanFiles">[docs]</a>    <span class="k">def</span> <span class="nf">cleanFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clean up the model files. Removes the model directory and all its contents.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outDir</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outDir</span><span class="p">)</span></div>

<div class="viewcode-block" id="QSPRModel.get_scoring_func"><a class="viewcode-back" href="../../../api/qsprpred.models.html#qsprpred.models.interfaces.QSPRModel.get_scoring_func">[docs]</a>    <span class="k">def</span> <span class="nf">get_scoring_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scoring</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get scoring function from sklearn.metrics.</span>

<span class="sd">        Args:</span>
<span class="sd">            scoring (Union[str, Callable]): metric name from sklearn.metrics or</span>
<span class="sd">                user-defined scoring function.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the scoring function is currently not supported by</span>
<span class="sd">                GridSearch and BayesOptimization.</span>

<span class="sd">        Returns:</span>
<span class="sd">            score_func (Callable): scorer function from sklearn.metrics (`str` as input)</span>
<span class="sd">            or user-defined function (`callable` as input)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">scoring</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_supported_scoring</span><span class="p">,</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scoring</span><span class="p">,</span> <span class="nb">str</span><span class="p">)]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Scoring function </span><span class="si">%s</span><span class="s2"> not supported. Supported scoring functions are: </span><span class="si">%s</span><span class="s2">&quot;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="n">scoring</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_supported_scoring</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">scoring</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">scoring</span>
        <span class="k">elif</span> <span class="n">scoring</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">ModelTasks</span><span class="o">.</span><span class="n">REGRESSION</span><span class="p">:</span>
                <span class="n">scorer</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get_scorer</span><span class="p">(</span><span class="s1">&#39;explained_variance&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">nClasses</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># multiclass</span>
                <span class="k">return</span> <span class="k">lambda</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="p">:</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;ovr&#39;</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">scorer</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get_scorer</span><span class="p">(</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scorer</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get_scorer</span><span class="p">(</span><span class="n">scoring</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scorer</span><span class="o">.</span><span class="n">_score_func</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Xuhan Liu, Sohvi Lukkonen, Helle van den Maagdenberg, Linde Schoenmaker, Martin Sicho.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>