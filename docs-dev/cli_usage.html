<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Command Line Interface Usage &mdash; QSPRpred 3.0.2a2.dev28+gdb815672 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
      <link rel="stylesheet" type="text/css" href="_static/design-elements.dd2be2f2a6c4c2be2874857420137035.css?v=8ed43ab2" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=4c3b5d92"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script>
    </script>
        <script src="_static/design-tabs.js?v=36754332"></script>
        <script src="_static/design-elements.bbdccc18c4abea9397628f9fea3d48c2.js?v=03c7770e"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Overview of available features" href="features.html" />
    <link rel="prev" title="Installation" href="install.html" />
 

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LJT8KBYKKV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LJT8KBYKKV');
</script>


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            QSPRpred
          </a>
              <div class="version">
                v3.0.2a2.dev28+gdb815672
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Welcome to QSPRpred’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Command Line Interface Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#cli-example">CLI Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#preparing-data">Preparing Data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#basics">Basics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#more">More</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#model-training">Model Training</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#model-basics">Basics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#model-more">More</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#prediction">Prediction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#prediction-basics">Basics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#prediction-more">More</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Overview of available features</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/modules.html">Python API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">QSPRpred</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Command Line Interface Usage</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="command-line-interface-usage">
<span id="cli-usage"></span><h1>Command Line Interface Usage<a class="headerlink" href="#command-line-interface-usage" title="Link to this heading"></a></h1>
<p>You can use the command-line interface to preprocess data and build models.
The description of the functionality can be displayed with the <code class="code docutils literal notranslate"><span class="pre">--help</span></code> argument,
e.g. the help message for the <code class="code docutils literal notranslate"><span class="pre">QSPRpred.data_CLI</span></code> script can be shown as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">qsprpred</span><span class="o">.</span><span class="n">data_CLI</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
<p>A simple command-line workflow to prepare your dataset and train QSPR models is given below (see <a class="reference internal" href="#cli-example"><span class="std std-ref">CLI Example</span></a>).</p>
<p>If you want more control over the inputs and outputs or want to customize QSPRpred for your purpose,
you can also use the Python API directly (see <a class="reference external" href="https://github.com/CDDLeiden/QSPRpred/tree/main/tutorials">tutorials</a>).</p>
<section id="cli-example">
<h2>CLI Example<a class="headerlink" href="#cli-example" title="Link to this heading"></a></h2>
<p>In this example, we will use the command line utilities of QSPRpred to train a QSAR model for the A2A and A2B receptor.
We will use the Adenosine dataset from the API tutorial. The data is available through <a class="reference external" href="https://1drv.ms/u/s!AtzWqu0inkjX3QRxXOkTFNv7IV7u?e=PPj0O2">OneDrive</a>
(just unzip and place the two datasets <strong>A2A_LIGANDS.tsv</strong> and <strong>AR_LIGANDS.tsv</strong> in the ‘tutorial_data’ folder) or recreate the dataset yourself by running ‘tutorial_data/create_tutorial_data.py’.</p>
<p>Input data should contain a column with SMILES sequences and at least one column with a property for modelling.
The <strong>AR_LIGANDS.tsv</strong> file contains a SMILES column, a column with the property <strong>pchembl_value_mean</strong> and a column with the property <strong>accession</strong> (uniprot accession numbers).
However, to create models for the A2A and A2B receptor, we need to have the data in a pivot table format, where the properties are in the columns.
To create this pivot table, we can use the pandas library in Python as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;tutorial_data/AR_LIGANDS.tsv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;SMILES&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;accession&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;pchembl_value_Mean&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;tutorial_data/AR_LIGANDS_pivot.tsv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>It is also possible to simply run the <strong>create_tutorial_data.py</strong> script in the <strong>tutorial_data</strong> folder with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">create_tutorial_data</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">m</span> <span class="n">AR_LIGANDS</span><span class="o">.</span><span class="n">tsv</span>
</pre></div>
</div>
<p>This will create a pivot table with the name <strong>AR_LIGANDS_pivot.tsv</strong> in the <strong>tutorial_data</strong> folder.
Our example dataset now contains a SMILES column and two columns with the properties <strong>P29274</strong> (A2AR) and <strong>P29275</strong> (A2BR)
(as well as a columns for A1 and A3, which we will not use in this example).</p>
<section id="preparing-data">
<h3>Preparing Data<a class="headerlink" href="#preparing-data" title="Link to this heading"></a></h3>
<section id="basics">
<span id="data-basics"></span><h4>Basics<a class="headerlink" href="#basics" title="Link to this heading"></a></h4>
<p>We will now use the QSPRpred <code class="code docutils literal notranslate"><span class="pre">QSPRpred.data_CLI</span></code> script for data preparation.
In the CLI we need to indicate which property/ies we are interested in predicting (here P29274 and P29275, the A2A and A2B receptor respectively),
this should be equal to the column names (should not contain spaces) containing the values to be predicted.
For regression models these columns should contain numerical datapoints.
For categorical models either categorical data or numerical data can be used (the latter will be categorized based on the activity threshold).
Furthermore, we should indicate how we wish to split the data to create a train and test set.
Here we will use a random split with a test fraction of 15%. We need to calculate features that describe the molecules,
here we use Morgan fingerprints.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># input is in tutorial/data/AR_LIGANDS_pivot.tsv</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">qsprpred</span><span class="o">.</span><span class="n">data_CLI</span> <span class="o">-</span><span class="n">i</span> <span class="o">./</span><span class="n">tutorial_data</span><span class="o">/</span><span class="n">AR_LIGANDS_pivot</span><span class="o">.</span><span class="n">tsv</span> <span class="o">-</span><span class="n">o</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">data</span> <span class="o">-</span><span class="n">pr</span> <span class="n">P29274</span> <span class="o">-</span><span class="n">pr</span> <span class="n">P29275</span> <span class="o">-</span><span class="n">r</span> <span class="n">REG</span> <span class="o">-</span><span class="n">sp</span> <span class="n">random</span> <span class="o">-</span><span class="n">sf</span> <span class="mf">0.15</span> <span class="o">-</span><span class="n">fe</span> <span class="n">Morgan</span>
</pre></div>
</div>
<p>Running this command will create folders <strong>tutorial_output/data</strong>, with subfolders <strong>P29274_REGRESSION</strong> and <strong>P29275_REGRESSION</strong> containing the prepared data.
Each subfolder, named by the property identifiers (i.e. P29274/P29275) and the model task (REGRESSION),
will contain the following files:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>File</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">{prefixes}_df.pkl</div>
<div class="line">{prefixes}_meta.json</div>
<div class="line">{prefixes}_MorganFP</div>
<div class="line">{prefixes}_MorganFP/{prefixes}_MorganFP_df.pkl</div>
<div class="line">{prefixes}_MorganFP/{prefixes}_MorganFP_meta.json</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Dataframe</div>
<div class="line">Meta data, also used to instantiate a QSPRData object</div>
<div class="line">Descriptor set folder</div>
<div class="line">Calculated descriptors</div>
<div class="line">Meta data of the descriptor set</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Furthermore, the command line interface will create a log file and settings file in the output folder.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>File</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">QSPRdata.json</div>
<div class="line">QSPRdata.log</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Command Line interface settings</div>
<div class="line">Log file</div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
<section id="more">
<span id="data-more"></span><h4>More<a class="headerlink" href="#more" title="Link to this heading"></a></h4>
<section id="run-settings-arguments">
<span id="data-run-settings-arguments"></span><h5>Run settings arguments<a class="headerlink" href="#run-settings-arguments" title="Link to this heading"></a></h5>
<p>Apart from the the input file name, there are a few other base options that can be set.
Including <code class="docutils literal notranslate"><span class="pre">-d</span></code>, will print debug information to the log file. The random
seed (<code class="docutils literal notranslate"><span class="pre">-ran</span></code>) can also be set manually, which should guarantee identical results while keeping the same random seed.
Furthermore, the number of cpu’s (-ncpu) used for model training. Finally, the name of the SMILES column in your dataset
can be indicated with <code class="docutils literal notranslate"><span class="pre">-sm</span></code> (default SMILES).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># input is in tutorial/data/AR_LIGANDS_pivot.tsv, setting debug flag, smiles column, random seed, number of cpu&#39;s</span>
    <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">qsprpred</span><span class="o">.</span><span class="n">data_CLI</span>  <span class="o">-</span><span class="n">i</span> <span class="o">./</span><span class="n">tutorial_data</span><span class="o">/</span><span class="n">AR_LIGANDS_pivot</span><span class="o">.</span><span class="n">tsv</span> <span class="o">-</span><span class="n">o</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">data</span> <span class="o">-</span><span class="n">sm</span> <span class="n">SMILES</span> <span class="o">-</span><span class="n">de</span> <span class="o">-</span><span class="n">ran</span> <span class="mi">42</span> <span class="o">-</span><span class="n">ncpu</span> <span class="mi">5</span> <span class="o">-</span><span class="n">pr</span> <span class="n">P29274</span> <span class="o">-</span><span class="n">pr</span> <span class="n">P29275</span> <span class="o">-</span><span class="n">r</span> <span class="n">REG</span> <span class="o">-</span><span class="n">sp</span> <span class="n">random</span> <span class="o">-</span><span class="n">sf</span> <span class="mf">0.15</span> <span class="o">-</span><span class="n">fe</span> <span class="n">Morgan</span>
</pre></div>
</div>
</section>
<section id="transform-target-property">
<h5>Transform target property<a class="headerlink" href="#transform-target-property" title="Link to this heading"></a></h5>
<p>To apply (<code class="docutils literal notranslate"><span class="pre">-tr</span></code>) transformations to target properties, indicate this in the CLI as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Log transform data for P29274</span>
    <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">qsprpred</span><span class="o">.</span><span class="n">data_CLI</span> <span class="o">-</span><span class="n">i</span> <span class="o">./</span><span class="n">tutorial_data</span><span class="o">/</span><span class="n">AR_LIGANDS_pivot</span><span class="o">.</span><span class="n">tsv</span> <span class="o">-</span><span class="n">o</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">data</span> <span class="o">-</span><span class="n">pr</span> <span class="n">P29274</span> <span class="o">-</span><span class="n">pr</span> <span class="n">P29275</span> <span class="o">-</span><span class="n">tr</span> <span class="s1">&#39;{&quot;P29274&quot;:&quot;log&quot;}&#39;</span> <span class="o">-</span><span class="n">r</span> <span class="n">REG</span> <span class="o">-</span><span class="n">sp</span> <span class="n">random</span> <span class="o">-</span><span class="n">sf</span> <span class="mf">0.15</span> <span class="o">-</span><span class="n">fe</span> <span class="n">Morgan</span>
</pre></div>
</div>
<p>note. on windows remove the single quotes around the dictionary and add backslashes before the double quotes, e.g. <code class="docutils literal notranslate"><span class="pre">-tr</span> <span class="pre">{\&quot;P29274\&quot;:\&quot;log\&quot;}</span></code></p>
</section>
<section id="train-test-split">
<h5>Train-test split<a class="headerlink" href="#train-test-split" title="Link to this heading"></a></h5>
<p>In the base example we use a random split to create the train and test set. There are several more options,
One is a scaffold split, where the data is split into a test and train set randomly but keeping molecules with the same
(Murcko) scaffold in the same set.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Scaffold split</span>
    <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">qsprpred</span><span class="o">.</span><span class="n">data_CLI</span> <span class="o">-</span><span class="n">i</span> <span class="o">./</span><span class="n">tutorial_data</span><span class="o">/</span><span class="n">AR_LIGANDS_pivot</span><span class="o">.</span><span class="n">tsv</span> <span class="o">-</span><span class="n">o</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">data</span> <span class="o">-</span><span class="n">pr</span> <span class="n">P29274</span> <span class="o">-</span><span class="n">pr</span> <span class="n">P29275</span> <span class="o">-</span><span class="n">r</span> <span class="n">REG</span> <span class="o">-</span><span class="n">sp</span> <span class="n">scaffold</span> <span class="o">-</span><span class="n">sf</span> <span class="mf">0.15</span> <span class="o">-</span><span class="n">fe</span> <span class="n">Morgan</span>
</pre></div>
</div>
<p>Another option is the cluster split, where the data is split into a test and train set randomly but keeping molecules with the same
clusters in the same set. Here you can set the clustering method as well (<code class="docutils literal notranslate"><span class="pre">-scm</span></code>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cluster split</span>
    <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">qsprpred</span><span class="o">.</span><span class="n">data_CLI</span> <span class="o">-</span><span class="n">i</span> <span class="o">./</span><span class="n">tutorial_data</span><span class="o">/</span><span class="n">AR_LIGANDS_pivot</span><span class="o">.</span><span class="n">tsv</span> <span class="o">-</span><span class="n">o</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">data</span> <span class="o">-</span><span class="n">pr</span> <span class="n">P29274</span> <span class="o">-</span><span class="n">pr</span> <span class="n">P29275</span> <span class="o">-</span><span class="n">r</span> <span class="n">REG</span> <span class="o">-</span><span class="n">sp</span> <span class="n">cluster</span> <span class="o">-</span><span class="n">scm</span> <span class="n">MaxMin</span> <span class="o">-</span><span class="n">sf</span> <span class="mf">0.15</span> <span class="o">-</span><span class="n">fe</span> <span class="n">Morgan</span>
</pre></div>
</div>
<p>The third option is a temporal split, where a column needs to be indicated which holds information on the time each
sample was observed and split based on threshold in a column. In this example, all samples after 2015 (in column <strong>year</strong>)
make up the test set. NOTE: this example will not work on the example set as it does not contain a <strong>year</strong> column.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Time split</span>
    <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">qsprpred</span><span class="o">.</span><span class="n">data_CLI</span> <span class="o">-</span><span class="n">i</span> <span class="o">./</span><span class="n">tutorial_data</span><span class="o">/</span><span class="n">AR_LIGANDS_pivot</span><span class="o">.</span><span class="n">tsv</span> <span class="o">-</span><span class="n">o</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">data</span> <span class="o">-</span><span class="n">pr</span> <span class="n">P29274</span> <span class="o">-</span><span class="n">pr</span> <span class="n">P29275</span> <span class="o">-</span><span class="n">r</span> <span class="n">REG</span>  <span class="o">-</span><span class="n">sp</span> <span class="n">time</span> <span class="o">-</span><span class="n">st</span> <span class="mi">2015</span> <span class="o">-</span><span class="n">stc</span> <span class="n">year</span> <span class="o">-</span><span class="n">fe</span> <span class="n">Morgan</span>
</pre></div>
</div>
<p>Lastly, the data can be split based on a specific column in the dataset. This column has to be named <strong>datasplit</strong>
where the value <strong>test</strong> indicates the test set and the value <strong>train</strong> indicates the train set.
NOTE. this example will not work on the example set as it does not contain a <strong>datasplit</strong> column.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Split based on a specific column</span>
    <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">qsprpred</span><span class="o">.</span><span class="n">data_CLI</span> <span class="o">-</span><span class="n">i</span> <span class="o">./</span><span class="n">tutorial_data</span><span class="o">/</span><span class="n">AR_LIGANDS_pivot</span><span class="o">.</span><span class="n">tsv</span> <span class="o">-</span><span class="n">o</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">data</span> <span class="o">-</span><span class="n">pr</span> <span class="n">P29274</span> <span class="o">-</span><span class="n">pr</span> <span class="n">P29275</span> <span class="o">-</span><span class="n">r</span> <span class="n">REG</span> <span class="o">-</span><span class="n">sp</span> <span class="n">manual</span> <span class="o">-</span><span class="n">sf</span> <span class="mf">0.15</span> <span class="o">-</span><span class="n">fe</span> <span class="n">Morgan</span>
</pre></div>
</div>
</section>
<section id="data-for-classification-models">
<h5>Data for classification models<a class="headerlink" href="#data-for-classification-models" title="Link to this heading"></a></h5>
<p>You can set whether to prepare data for regression, classification or both.
The default setting is to run both, but you can run either by setting the
regression argument to true/REG for regression or false/CLS for classification.
When using classification, the threshold(s) for each property (that has not been preclassified) need to be included.
If the data is already preclassified, the threshold has to be set to ‘precomputed’.
This is set using a dictionary. In case of multi-class classification the bounderies of
the bins need to be given. For binary classification only give 1 threshold per property.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Classification and regression</span>
    <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">qsprpred</span><span class="o">.</span><span class="n">data_CLI</span> <span class="o">-</span><span class="n">i</span> <span class="o">./</span><span class="n">tutorial_data</span><span class="o">/</span><span class="n">AR_LIGANDS_pivot</span><span class="o">.</span><span class="n">tsv</span> <span class="o">-</span><span class="n">o</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">data</span> <span class="o">-</span><span class="n">pr</span> <span class="n">P29274</span> <span class="o">-</span><span class="n">pr</span> <span class="n">P29275</span> <span class="o">-</span><span class="n">r</span> <span class="n">CLS</span> <span class="o">-</span><span class="n">sp</span> <span class="n">random</span> <span class="o">-</span><span class="n">sf</span> <span class="mf">0.15</span> <span class="o">-</span><span class="n">fe</span> <span class="n">Morgan</span> <span class="o">-</span><span class="n">th</span> <span class="s1">&#39;{&quot;P29274&quot;:[6.5],&quot;P29275&quot;:[0,4,6,12]}&#39;</span>
</pre></div>
</div>
<p>note. on windows remove the single quotes around the dictionary and add backslashes before the double quotes, e.g. <code class="docutils literal notranslate"><span class="pre">-th</span> <span class="pre">{\&quot;P29274\&quot;:[6.5],\&quot;P29275\&quot;:[0,4,6,10]}</span></code>.</p>
</section>
<section id="feature-calculation">
<h5>Feature calculation<a class="headerlink" href="#feature-calculation" title="Link to this heading"></a></h5>
<p>There are many different descriptor sets that can be calculated from the CLI,
such as Morgan fingerprints, rdkit, Mordred, Mold2 and Padel descriptors.
Check the help message for the full list of available descriptor sets.
The different descriptor sets can also be combined.
For more control over the descriptor settings use the python API.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># With Morgan, RDkit, Mordred, Mold2, PaDEL and DrugEx descriptors</span>
    <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">qsprpred</span><span class="o">.</span><span class="n">data_CLI</span> <span class="o">-</span><span class="n">i</span> <span class="o">./</span><span class="n">tutorial_data</span><span class="o">/</span><span class="n">AR_LIGANDS_pivot</span><span class="o">.</span><span class="n">tsv</span> <span class="o">-</span><span class="n">o</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">data</span> <span class="o">-</span><span class="n">pr</span> <span class="n">P29274</span> <span class="o">-</span><span class="n">pr</span> <span class="n">P29275</span> <span class="o">-</span><span class="n">r</span> <span class="n">REG</span> <span class="o">-</span><span class="n">sp</span> <span class="n">random</span> <span class="o">-</span><span class="n">sf</span> <span class="mf">0.15</span> <span class="o">-</span><span class="n">fe</span> <span class="n">Morgan</span> <span class="n">RDkit</span> <span class="n">Mordred</span> <span class="n">Mold2</span> <span class="n">PaDEL</span> <span class="n">DrugEx</span>
</pre></div>
</div>
</section>
<section id="feature-filtering">
<h5>Feature filtering<a class="headerlink" href="#feature-filtering" title="Link to this heading"></a></h5>
<p>The calculated features can also be filtered. Three different filters are implemented in
QSPRpred, namely a high correlation filter, a low variance filter and the boruta filter.
The high correlation filter and low variance filter need to be set with a threshold
for filtering. The boruta filter needs a threshold for the comparison between shadow
and real features.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># input is in ./data/LIGAND_RAW_small.tsv</span>
   <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">qsprpred</span><span class="o">.</span><span class="n">data_CLI</span> <span class="o">-</span><span class="n">i</span> <span class="o">./</span><span class="n">tutorial_data</span><span class="o">/</span><span class="n">AR_LIGANDS_pivot</span><span class="o">.</span><span class="n">tsv</span> <span class="o">-</span><span class="n">o</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">data</span> <span class="o">-</span><span class="n">pr</span> <span class="n">P29274</span> <span class="o">-</span><span class="n">pr</span> <span class="n">P29275</span> <span class="o">-</span><span class="n">r</span> <span class="n">REG</span> <span class="o">-</span><span class="n">sp</span> <span class="n">random</span> <span class="o">-</span><span class="n">sf</span> <span class="mf">0.15</span> <span class="o">-</span><span class="n">fe</span> <span class="n">Morgan</span> <span class="o">-</span><span class="n">lv</span> <span class="mf">0.1</span> <span class="o">-</span><span class="n">hc</span> <span class="mf">0.9</span> <span class="o">-</span><span class="n">bf</span> <span class="mi">90</span>
</pre></div>
</div>
</section>
<section id="papyrus-low-quality-filter">
<h5>Papyrus Low quality filter<a class="headerlink" href="#papyrus-low-quality-filter" title="Link to this heading"></a></h5>
<p>Specifically for use with a dataset from the <a class="reference external" href="https://chemrxiv.org/engage/chemrxiv/article-details/617aa2467a002162403d71f0">Papyrus dataset</a>,
an option is included for filtering low quality data from the dataset (All data is removed with value ‘Low’ in column ‘Quality’).
To apply this filter include <code class="docutils literal notranslate"><span class="pre">-lq</span></code> or <code class="docutils literal notranslate"><span class="pre">--low_quality</span></code> in your command.</p>
</section>
<section id="multitask-data">
<h5>Multitask data<a class="headerlink" href="#multitask-data" title="Link to this heading"></a></h5>
<p>Multitask modelling is possible by passing multiple properties to the <code class="docutils literal notranslate"><span class="pre">-pr</span></code> argument. Furthermore, missing data can be
imputed using the <code class="docutils literal notranslate"><span class="pre">-im</span></code> argument. You can combine any number of targets and combination of regression and classification
tasks for the data preparation, however currently the DNN models do not support multitask modelling and only the random
forest models and KNN sklearn models are supported for multitask. The multitask sklearn modelling is only possible for
multiple regression task or multiple single class classification tasks. For multiple multi-class classification tasks or
a combination of regression and classification tasks, the multitask modelling is not supported at the moment.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># input is in ./data/parkinsons_pivot.tsv</span>
    <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">qsprpred</span><span class="o">.</span><span class="n">data_CLI</span> <span class="o">-</span><span class="n">i</span> <span class="o">./</span><span class="n">tutorial_data</span><span class="o">/</span><span class="n">AR_LIGANDS_pivot</span><span class="o">.</span><span class="n">tsv</span> <span class="o">-</span><span class="n">o</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">data</span> <span class="o">-</span><span class="n">pr</span> <span class="n">P29274</span> <span class="n">P29275</span> <span class="o">-</span><span class="n">r</span> <span class="n">REG</span> <span class="o">-</span><span class="n">sp</span> <span class="n">random</span> <span class="o">-</span><span class="n">sf</span> <span class="mf">0.15</span> <span class="o">-</span><span class="n">fe</span> <span class="n">Morgan</span> <span class="o">-</span><span class="n">im</span> <span class="s1">&#39;{&quot;P29274&quot;:&quot;mean&quot;, &quot;P29275&quot;:&quot;median&quot;}&#39;</span>
</pre></div>
</div>
<p>Note. on windows remove the single quotes around the dictionary and add backslashes before the double quotes, e.g. -im {&quot;P29274&quot;:&quot;mean&quot;,&quot;P29275&quot;:&quot;median&quot;}</p>
</section>
</section>
</section>
<section id="model-training">
<h3>Model Training<a class="headerlink" href="#model-training" title="Link to this heading"></a></h3>
<section id="model-basics">
<span id="id1"></span><h4>Basics<a class="headerlink" href="#model-basics" title="Link to this heading"></a></h4>
<p>Finally, we need to indicate what models we want to train and which steps to take in the training.
In this example, we will build regression random forest models through passing the prepared regression datasets files
<strong>P29274_REGRESSION</strong> and <strong>P29275_REGRESSION</strong> to the <code class="docutils literal notranslate"><span class="pre">-dp</span></code> argument. If you wish to train classification models, you
can pass the classification datasets <strong>P29274_SINGLECLASS</strong> and <strong>P29275_MULTICLASS</strong> to the <code class="docutils literal notranslate"><span class="pre">-dp</span></code> argument
(or any combination thereof). The model type is set with <code class="docutils literal notranslate"><span class="pre">-m</span></code>.
We will also evaluate the model through cross-validation (<code class="docutils literal notranslate"><span class="pre">-me</span></code>) and train the model on all data to save for further use (<code class="docutils literal notranslate"><span class="pre">-s</span></code>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using the prepared datasets P29274_REGRESSION and P29275_REGRESSION</span>
    <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">qsprpred</span><span class="o">.</span><span class="n">model_CLI</span> <span class="o">-</span><span class="n">dp</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">P29274_REGRESSION</span><span class="o">/</span><span class="n">P29274_REGRESSION_meta</span><span class="o">.</span><span class="n">json</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">P29275_REGRESSION</span><span class="o">/</span><span class="n">P29275_REGRESSION_meta</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">o</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">models</span> <span class="o">-</span><span class="n">mt</span> <span class="n">RF</span> <span class="o">-</span><span class="n">me</span> <span class="o">-</span><span class="n">s</span>
</pre></div>
</div>
<p>This will create a folder <strong>tutorial_output/models</strong> containing the trained models.
Each subfolder, named by the model type (RF) and the dataset name (P29274_REGRESSION/P29275_REGRESSION),
will contain the following files:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>File</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">{prefixes}.json</div>
<div class="line">{prefixes}_meta.json</div>
<div class="line">{prefixes}_cv.tsv</div>
<div class="line">{prefixes}_ind.tsv</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Model file</div>
<div class="line">Meta data, also used to instantiate a QSPRModel object</div>
<div class="line">Cross-validation predictions</div>
<div class="line">Test set predictions</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Furthermore, the command line interface will create a log file and settings file in the output folder.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>File</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">QSPRmodel.json</div>
<div class="line">QSPRmodel.log</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Command Line interface settings</div>
<div class="line">Log file</div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
<section id="model-more">
<span id="id2"></span><h4>More<a class="headerlink" href="#model-more" title="Link to this heading"></a></h4>
<p>The model training can be further customized with several CLI arguments.
For more control over the model training settings use the python API.
Here you can find a short overview.</p>
<section id="model-run-settings-arguments">
<span id="id3"></span><h5>Run settings arguments<a class="headerlink" href="#model-run-settings-arguments" title="Link to this heading"></a></h5>
<p>As with the data preparation including <code class="docutils literal notranslate"><span class="pre">-de</span></code>, will print debug information to the log file. The random
seed can also be set manually (although identical results are not guaranteed while keeping
the same random seed). Furthermore, the number of cpu’s used for model training and the
gpu number for training pytorch models can be set.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setting debug flag, random seed, number of cpu&#39;s and a specific gpu (for now multiple gpu&#39;s not possible)</span>
    <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">qsprpred</span><span class="o">.</span><span class="n">model_CLI</span> <span class="o">-</span><span class="n">de</span> <span class="o">-</span><span class="n">ran</span> <span class="mi">42</span> <span class="o">-</span><span class="n">ncpu</span> <span class="mi">5</span> <span class="o">-</span><span class="n">gpus</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span><span class="n">dp</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">P29274_REGRESSION</span><span class="o">/</span><span class="n">P29274_REGRESSION_meta</span><span class="o">.</span><span class="n">json</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">P29275_REGRESSION</span><span class="o">/</span><span class="n">P29275_REGRESSION_meta</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">o</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">models</span> <span class="o">-</span><span class="n">mt</span> <span class="n">RF</span> <span class="o">-</span><span class="n">me</span> <span class="o">-</span><span class="n">s</span>
</pre></div>
</div>
</section>
<section id="model-types">
<h5>model types<a class="headerlink" href="#model-types" title="Link to this heading"></a></h5>
<p>You also need to indicate which models you want to run, out of the following model types:
‘RF’ (Random Forest), ‘XGB’ (XGboost), ‘SVM’ (Support Vector Machine), ‘PLS’ (partial least squares regression),
‘KNN’ (k-nearest neighbours), NB’ (Naive Bayes) and/or ‘DNN’ (pytorch fully connected neural net).
The default is to run all the different model types.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Training a RF, SVM and PLS model</span>
    <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">qsprpred</span><span class="o">.</span><span class="n">model_CLI</span> <span class="o">-</span><span class="n">dp</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">P29274_REGRESSION</span><span class="o">/</span><span class="n">P29274_REGRESSION_meta</span><span class="o">.</span><span class="n">json</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">P29275_REGRESSION</span><span class="o">/</span><span class="n">P29275_REGRESSION_meta</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">o</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">models</span> <span class="o">-</span><span class="n">me</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">mt</span> <span class="n">RF</span> <span class="n">SVM</span> <span class="n">PLS</span>
</pre></div>
</div>
</section>
<section id="defining-model-parameters">
<h5>Defining model parameters<a class="headerlink" href="#defining-model-parameters" title="Link to this heading"></a></h5>
<p>Specific model parameters can be set with the parameters argument by passing a json file.</p>
<p>./myparams.json
..  code-block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="s2">&quot;RF&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">null</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="s2">&quot;max_features&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sqrt&quot;</span><span class="p">,</span> <span class="s2">&quot;log2&quot;</span><span class="p">],</span>
        <span class="s2">&quot;min_samples_leaf&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]}],</span>
<span class="p">[</span><span class="s2">&quot;KNN&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;n_neighbors&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>
        <span class="s2">&quot;weights&quot;</span>      <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;uniform&quot;</span><span class="p">,</span> <span class="s2">&quot;distance&quot;</span><span class="p">]}]]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setting some parameter values for a Random Forest and k-nearest neighbours model</span>
    <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">qsprpred</span><span class="o">.</span><span class="n">model_CLI</span> <span class="o">-</span><span class="n">dp</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">P29274_REGRESSION</span><span class="o">/</span><span class="n">P29274_REGRESSION_meta</span><span class="o">.</span><span class="n">json</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">P29275_REGRESSION</span><span class="o">/</span><span class="n">P29275_REGRESSION_meta</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">o</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">models</span> <span class="o">-</span><span class="n">mt</span> <span class="n">RF</span> <span class="n">KNN</span> <span class="o">-</span><span class="n">me</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">p</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">myparams</span>
</pre></div>
</div>
<p>Specifically for the training of the DNN model, you can set the tolerance and the patience from the CLI.
Tolerance gives the mimimum decrease in loss needed to count as an improvement and
patience is the number of training epochs without improvement in loss to stop the training.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setting the tolerance and patience for training a DNN model</span>
    <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">qsprpred</span><span class="o">.</span><span class="n">model_CLI</span> <span class="o">-</span><span class="n">dp</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">P29274_REGRESSION</span><span class="o">/</span><span class="n">P29274_REGRESSION_meta</span><span class="o">.</span><span class="n">json</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">P29275_REGRESSION</span><span class="o">/</span><span class="n">P29275_REGRESSION_meta</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">o</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">models</span> <span class="o">-</span><span class="n">mt</span> <span class="n">DNN</span> <span class="o">-</span><span class="n">me</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">tol</span> <span class="mf">0.02</span> <span class="o">-</span><span class="n">pat</span> <span class="mi">100</span>
</pre></div>
</div>
</section>
<section id="hyperparameter-optimization">
<h5>Hyperparameter optimization<a class="headerlink" href="#hyperparameter-optimization" title="Link to this heading"></a></h5>
<p>In addition to setting model parameters manually, a hyperparameter search can be performed.
In QSPRpred, two methods of hyperparameter optimization are implemented: grid search and
bayesian optimization. For baysian optimization also give the number of trials.
The search space needs to be set using a json file.
A simple search space file for a RF and KNN model should look as given below.
Note the indication of the model type as first list item and type of optimization algorithm
as third list item. The search space file should always include all models to be trained.</p>
<p>./mysearchspace.json
..  code-block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="s2">&quot;RF&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">null</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="s2">&quot;max_features&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sqrt&quot;</span><span class="p">,</span> <span class="s2">&quot;log2&quot;</span><span class="p">],</span>
        <span class="s2">&quot;min_samples_leaf&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]},</span> <span class="s2">&quot;grid&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;RF&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;n_estimators&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2000</span><span class="p">],</span>
        <span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="s2">&quot;min_samples_leaf&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">25</span><span class="p">]},</span> <span class="s2">&quot;bayes&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;KNN&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;n_neighbors&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>
        <span class="s2">&quot;weights&quot;</span>      <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;uniform&quot;</span><span class="p">,</span> <span class="s2">&quot;distance&quot;</span><span class="p">]},</span> <span class="s2">&quot;grid&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;KNN&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;n_neighbors&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="s2">&quot;weights&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;categorical&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;uniform&quot;</span><span class="p">,</span> <span class="s2">&quot;distance&quot;</span><span class="p">]],</span>
        <span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;categorical&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;euclidean&quot;</span><span class="p">,</span><span class="s2">&quot;manhattan&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;chebyshev&quot;</span><span class="p">,</span><span class="s2">&quot;minkowski&quot;</span><span class="p">]]},</span> <span class="s2">&quot;bayes&quot;</span><span class="p">]]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Bayesian optimization</span>
    <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">qsprpred</span><span class="o">.</span><span class="n">model_CLI</span> <span class="o">-</span><span class="n">dp</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">P29274_REGRESSION</span><span class="o">/</span><span class="n">P29274_REGRESSION_meta</span><span class="o">.</span><span class="n">json</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">P29275_REGRESSION</span><span class="o">/</span><span class="n">P29275_REGRESSION_meta</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">o</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">models</span> <span class="o">-</span><span class="n">mt</span> <span class="n">RF</span> <span class="o">-</span><span class="n">me</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">o</span> <span class="n">bayes</span> <span class="o">-</span><span class="n">nt</span> <span class="mi">5</span> <span class="o">-</span><span class="n">ss</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">mysearchspace</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">me</span> <span class="o">-</span><span class="n">s</span>
</pre></div>
</div>
</section>
<section id="multitask-modelling">
<h5>Multitask modelling<a class="headerlink" href="#multitask-modelling" title="Link to this heading"></a></h5>
<p>Multitask modelling is also possible. This means that the models are trained on multiple targets at once.
The modelling arguments are the same as for single task modelling, you just need to specifiy a multitask
dataset data prefix (see multitask data preparation).</p>
</section>
</section>
</section>
<section id="prediction">
<h3>Prediction<a class="headerlink" href="#prediction" title="Link to this heading"></a></h3>
<p>Furthermore, trained QSPRpred models can be used to predict values from SMILES from the command line interface <code class="code docutils literal notranslate"><span class="pre">predict_CLI.py</span></code>.</p>
<section id="prediction-basics">
<span id="id4"></span><h4>Basics<a class="headerlink" href="#prediction-basics" title="Link to this heading"></a></h4>
<p>Here we will predict activity values for the A1 (P29274) and A3 receptor (P29275) on the SMILES in the
dataset used in the previous examples using the models from the previous examples. The input <code class="docutils literal notranslate"><span class="pre">-i</span></code> here is the
set of SMILES for which we want to predict activity values. The argument <code class="docutils literal notranslate"><span class="pre">-mp</span></code>, is the paths to the meta files of the
models we want to use for prediction relative to the base-directory subfolder qspr/models.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Making predictions for the A2A and A2B receptor</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">qsprpred</span><span class="o">.</span><span class="n">predict_CLI</span> <span class="o">-</span><span class="n">i</span> <span class="o">./</span><span class="n">tutorial_data</span><span class="o">/</span><span class="n">AR_LIGANDS_pivot</span><span class="o">.</span><span class="n">tsv</span> <span class="o">-</span><span class="n">o</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">predictions</span><span class="o">/</span><span class="n">AR_LIGANDS_preds</span><span class="o">.</span><span class="n">tsv</span> <span class="o">-</span><span class="n">mp</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">RF_P29274_REGRESSION</span><span class="o">/</span><span class="n">RF_P29274_REGRESSION_meta</span><span class="o">.</span><span class="n">json</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">RF_P29275_REGRESSION</span><span class="o">/</span><span class="n">RF_P29275_REGRESSION_meta</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
</section>
<section id="prediction-more">
<span id="id5"></span><h4>More<a class="headerlink" href="#prediction-more" title="Link to this heading"></a></h4>
<p>The predictions can be further customized with several CLI arguments.
Here you can find a short overview.</p>
<section id="prediction-run-settings-arguments">
<span id="id6"></span><h5>Run settings arguments<a class="headerlink" href="#prediction-run-settings-arguments" title="Link to this heading"></a></h5>
<p>As with the data preparation including <code class="docutils literal notranslate"><span class="pre">-de</span></code>, will print debug information to the log file. The random
seed can also be set manually. Furthermore, the number of cpu’s used for model prediction and the
gpu number for prediction with pytorch models can be set.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setting debug flag, random seed, output file name, number of cpu&#39;s and a specific gpu (for now multiple gpu&#39;s not possible)</span>
    <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">qsprpred</span><span class="o">.</span><span class="n">predict_CLI</span> <span class="o">-</span><span class="n">i</span> <span class="o">./</span><span class="n">tutorial_data</span><span class="o">/</span><span class="n">AR_LIGANDS_pivot</span><span class="o">.</span><span class="n">tsv</span> <span class="o">-</span><span class="n">o</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">predictions</span><span class="o">/</span><span class="n">AR_LIGANDS_preds</span><span class="o">.</span><span class="n">tsv</span> <span class="o">-</span><span class="n">mp</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">RF_P29274_REGRESSION</span><span class="o">/</span><span class="n">RF_P29274_REGRESSION_meta</span><span class="o">.</span><span class="n">json</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">RF_P29275_REGRESSION</span><span class="o">/</span><span class="n">RF_P29275_REGRESSION_meta</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">de</span> <span class="o">-</span><span class="n">ran</span> <span class="mi">42</span> <span class="o">-</span><span class="n">ncpu</span> <span class="mi">5</span> <span class="o">-</span><span class="n">gpus</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="adding-probability-predictions">
<h5>Adding probability predictions<a class="headerlink" href="#adding-probability-predictions" title="Link to this heading"></a></h5>
<p>When using a classification model, the probability of the predicted class can be added to the output file using the <code class="docutils literal notranslate"><span class="pre">-pr</span></code> flag.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Adding probability predictions</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">qsprpred</span><span class="o">.</span><span class="n">predict_CLI</span> <span class="o">-</span><span class="n">i</span> <span class="o">./</span><span class="n">tutorial_data</span><span class="o">/</span><span class="n">AR_LIGANDS_pivot</span><span class="o">.</span><span class="n">tsv</span> <span class="o">-</span><span class="n">o</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">predictions</span><span class="o">/</span><span class="n">AR_LIGANDS_preds</span><span class="o">.</span><span class="n">tsv</span> <span class="o">-</span><span class="n">mp</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">RF_P29274_SINGLECLASS</span><span class="o">/</span><span class="n">RF_P29274_SINGLECLASS_meta</span><span class="o">.</span><span class="n">json</span> <span class="o">./</span><span class="n">tutorial_output</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">RF_P29275_MULTICLASS</span><span class="o">/</span><span class="n">RF_P29275_MULTICLASS_meta</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">pr</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="install.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="features.html" class="btn btn-neutral float-right" title="Overview of available features" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>